<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Pipelines | mlr3 book</title>
<meta name="author" content="Marc Becker">
<meta name="author" content="Martin Binder">
<meta name="author" content="Bernd Bischl">
<meta name="author" content="Lars Kotthoff">
<meta name="author" content="Michel Lang">
<meta name="author" content="Florian Pfisterer">
<meta name="author" content="Nicholas G. Reich">
<meta name="author" content="Jakob Richter">
<meta name="author" content="Patrick Schratz">
<meta name="author" content="Raphael Sonabend">
<meta name="author" content="Damir Pulatov">
<meta name="description" content="mlr3pipelines (Binder et al. 2021) is a dataflow programming toolkit. This chapter focuses on the applicant’s side of the package. A more in-depth and technically oriented guide can be found in...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="5 Pipelines | mlr3 book">
<meta property="og:type" content="book">
<meta property="og:url" content="https://mlr3book.mlr-org.com/pipelines.html">
<meta property="og:image" content="https://mlr3book.mlr-org.com//block.png">
<meta property="og:description" content="mlr3pipelines (Binder et al. 2021) is a dataflow programming toolkit. This chapter focuses on the applicant’s side of the package. A more in-depth and technically oriented guide can be found in...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 Pipelines | mlr3 book">
<meta name="twitter:description" content="mlr3pipelines (Binder et al. 2021) is a dataflow programming toolkit. This chapter focuses on the applicant’s side of the package. A more in-depth and technically oriented guide can be found in...">
<meta name="twitter:image" content="https://mlr3book.mlr-org.com//block.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">mlr3 book</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Quickstart</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction and Overview</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">2</span> Basics</a></li>
<li><a class="" href="perf-eval-cmp.html"><span class="header-section-number">3</span> Performance Evaluation and Comparison</a></li>
<li><a class="" href="optimization.html"><span class="header-section-number">4</span> Model Optimization</a></li>
<li><a class="active" href="pipelines.html"><span class="header-section-number">5</span> Pipelines</a></li>
<li><a class="" href="technical.html"><span class="header-section-number">6</span> Technical</a></li>
<li><a class="" href="extending.html"><span class="header-section-number">7</span> Extending</a></li>
<li><a class="" href="special-tasks.html"><span class="header-section-number">8</span> Special Tasks</a></li>
<li><a class="" href="interpretation.html"><span class="header-section-number">9</span> Model Interpretation</a></li>
<li><a class="" href="appendix.html"><span class="header-section-number">10</span> Appendix</a></li>
<li><a class="" href="citation-info.html">Citation Info</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mlr-org/mlr3book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="pipelines" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Pipelines<a class="anchor" aria-label="anchor" href="#pipelines"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a> <span class="citation">(<a href="references.html#ref-mlr3pipelines" role="doc-biblioref">Binder et al. 2021</a>)</span> is a dataflow programming toolkit.
This chapter focuses on the applicant’s side of the package.
A more in-depth and technically oriented guide can be found in the <a href="pipelines.html#in-depth-pipelines">In-depth look into mlr3pipelines</a> chapter.</p>
<p>Machine learning workflows can be written as directed “Graphs”/“Pipelines” that represent data flows between preprocessing, model fitting, and ensemble learning units in an expressive and intuitive language.
We will most often use the term “Graph” in this manual but it can interchangeably be used with “pipeline” or “workflow”.</p>
<p>Below you can examine an example for such a graph:</p>
<div class="inline-figure"><img src="images/single_pipe.svg" width="98%" style="display: block; margin: auto;"></div>
<p>Single computational steps can be represented as so-called PipeOps, which can then be connected with directed edges in a Graph.
The scope of <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a> is still growing.
Currently supported features are:</p>
<ul>
<li>Data manipulation and preprocessing operations, e.g. PCA, feature filtering, imputation</li>
<li>Task subsampling for speed and outcome class imbalance handling</li>
<li>
<a href="https://mlr3.mlr-org.com">mlr3</a> Learner operations for prediction and stacking</li>
<li>Ensemble methods and aggregation of predictions</li>
</ul>
<p>Additionally, we implement several meta operators that can be used to construct powerful pipelines:</p>
<ul>
<li>Simultaneous path branching (data going both ways)</li>
<li>Alternative path branching (data going one specific way, controlled by hyperparameters)</li>
</ul>
<p>An extensive introduction to creating custom <strong>PipeOps</strong> (PO’s) can be found in the <a href="extending.html#extending-pipeops">technical introduction</a>.</p>
<p>Using methods from <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a>, it is even possible to simultaneously optimize parameters of multiple processing units.</p>
<p>A predecessor to this package is the <a href="https://cran.r-project.org/package=mlrCPO">mlrCPO</a> package, which works with <a href="https://cran.r-project.org/package=mlr">mlr</a> 2.x.
Other packages that provide, to varying degree, some preprocessing functionality or machine learning domain specific language, are:</p>
<ul>
<li>the <a href="https://cran.r-project.org/package=caret">caret</a> package and the related <a href="https://cran.r-project.org/package=recipes">recipes</a> project</li>
<li>the <a href="https://cran.r-project.org/package=dplyr">dplyr</a> package</li>
</ul>
<p>An example for a Pipeline that can be constructed using <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a> is depicted below:</p>
<div class="inline-figure"><img src="05-pipelines_files/figure-html/04-pipelines-002-1.svg" width="672" style="display: block; margin: auto;"></div>

<div id="pipe-pipeops" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> The Building Blocks: PipeOps<a class="anchor" aria-label="anchor" href="#pipe-pipeops"><i class="fas fa-link"></i></a>
</h2>
<p>The building blocks of <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a> are <strong>PipeOp</strong>-objects (PO).
They can be constructed directly using <code>PipeOp&lt;NAME&gt;$new()</code>, but the recommended way is to retrieve them from the <code>mlr_pipeops</code> dictionary:</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://mlr3pipelines.mlr-org.com">"mlr3pipelines"</a></span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">mlr_pipeops</span><span class="op">)</span></code></pre></div>
<pre><code>##                       key           packages                             tags
##  1:                boxcox      bestNormalize                   data transform
##  2:                branch                                                meta
##  3:                 chunk                                                meta
##  4:        classbalancing                      imbalanced data,data transform
##  5:            classifavg              stats                         ensemble
##  6:          classweights                      imbalanced data,data transform
##  7:              colapply                                      data transform
##  8:       collapsefactors                                      data transform
##  9:              colroles                                      data transform
## 10:                  copy                                                meta
## 11:          datefeatures                                      data transform
## 12:                encode              stats            encode,data transform
## 13:          encodeimpact                               encode,data transform
## 14:            encodelmer        lme4,nloptr            encode,data transform
## 15:          featureunion                                            ensemble
## 16:                filter                    feature selection,data transform
## 17:            fixfactors                            robustify,data transform
## 18:               histbin           graphics                   data transform
## 19:                   ica            fastICA                   data transform
## 20:        imputeconstant                                            missings
## 21:            imputehist           graphics                         missings
## 22:         imputelearner                                            missings
## 23:            imputemean                                            missings
## 24:          imputemedian              stats                         missings
## 25:            imputemode                                            missings
## 26:             imputeoor                                            missings
## 27:          imputesample                                            missings
## 28:             kernelpca            kernlab                   data transform
## 29:               learner                                             learner
## 30:            learner_cv                     learner,ensemble,data transform
## 31:               missind                             missings,data transform
## 32:           modelmatrix              stats                   data transform
## 33:     multiplicityexply                                        multiplicity
## 34:     multiplicityimply                                        multiplicity
## 35:                mutate                                      data transform
## 36:                   nmf           MASS,NMF                   data transform
## 37:                   nop                                                meta
## 38:              ovrsplit                       target transform,multiplicity
## 39:              ovrunite                               multiplicity,ensemble
## 40:                   pca                                      data transform
## 41:                 proxy                                                meta
## 42:           quantilebin              stats                   data transform
## 43:      randomprojection                                      data transform
## 44:        randomresponse                                            abstract
## 45:               regravg                                            ensemble
## 46:       removeconstants                            robustify,data transform
## 47:         renamecolumns                                      data transform
## 48:             replicate                                        multiplicity
## 49:                 scale                                      data transform
## 50:           scalemaxabs                                      data transform
## 51:            scalerange                                      data transform
## 52:                select                    feature selection,data transform
## 53:                 smote        smotefamily   imbalanced data,data transform
## 54:           spatialsign                                      data transform
## 55:             subsample                                      data transform
## 56:          targetinvert                                            abstract
## 57:          targetmutate                                    target transform
## 58: targettrafoscalerange                                    target transform
## 59:        textvectorizer quanteda,stopwords                   data transform
## 60:             threshold                                    target transform
## 61:         tunethreshold              bbotk                 target transform
## 62:              unbranch                                                meta
## 63:                vtreat             vtreat   encode,missings,data transform
## 64:            yeojohnson      bestNormalize                   data transform
##                       key           packages                             tags
##                                            feature_types input.num output.num
##  1:                                      numeric,integer         1          1
##  2:                                                   NA         1         NA
##  3:                                                   NA         1         NA
##  4: logical,integer,numeric,character,factor,ordered,...         1          1
##  5:                                                   NA        NA          1
##  6: logical,integer,numeric,character,factor,ordered,...         1          1
##  7: logical,integer,numeric,character,factor,ordered,...         1          1
##  8:                                       factor,ordered         1          1
##  9: logical,integer,numeric,character,factor,ordered,...         1          1
## 10:                                                   NA         1         NA
## 11:                                              POSIXct         1          1
## 12:                                       factor,ordered         1          1
## 13:                                       factor,ordered         1          1
## 14:                                       factor,ordered         1          1
## 15:                                                   NA        NA          1
## 16: logical,integer,numeric,character,factor,ordered,...         1          1
## 17:                                       factor,ordered         1          1
## 18:                                      numeric,integer         1          1
## 19:                                      numeric,integer         1          1
## 20: logical,integer,numeric,character,factor,ordered,...         1          1
## 21:                                      integer,numeric         1          1
## 22:                               logical,factor,ordered         1          1
## 23:                                      numeric,integer         1          1
## 24:                                      numeric,integer         1          1
## 25:               factor,integer,logical,numeric,ordered         1          1
## 26:             character,factor,integer,numeric,ordered         1          1
## 27:               factor,integer,logical,numeric,ordered         1          1
## 28:                                      numeric,integer         1          1
## 29:                                                   NA         1          1
## 30: logical,integer,numeric,character,factor,ordered,...         1          1
## 31: logical,integer,numeric,character,factor,ordered,...         1          1
## 32: logical,integer,numeric,character,factor,ordered,...         1          1
## 33:                                                   NA         1         NA
## 34:                                                   NA        NA          1
## 35: logical,integer,numeric,character,factor,ordered,...         1          1
## 36:                                      numeric,integer         1          1
## 37:                                                   NA         1          1
## 38:                                                   NA         1          1
## 39:                                                   NA         1          1
## 40:                                      numeric,integer         1          1
## 41:                                                   NA        NA          1
## 42:                                      numeric,integer         1          1
## 43:                                      numeric,integer         1          1
## 44:                                                   NA         1          1
## 45:                                                   NA        NA          1
## 46: logical,integer,numeric,character,factor,ordered,...         1          1
## 47: logical,integer,numeric,character,factor,ordered,...         1          1
## 48:                                                   NA         1          1
## 49:                                      numeric,integer         1          1
## 50:                                      numeric,integer         1          1
## 51:                                      numeric,integer         1          1
## 52: logical,integer,numeric,character,factor,ordered,...         1          1
## 53: logical,integer,numeric,character,factor,ordered,...         1          1
## 54:                                      numeric,integer         1          1
## 55: logical,integer,numeric,character,factor,ordered,...         1          1
## 56:                                                   NA         2          1
## 57:                                                   NA         1          2
## 58:                                                   NA         1          2
## 59:                                            character         1          1
## 60:                                                   NA         1          1
## 61:                                                   NA         1          1
## 62:                                                   NA        NA          1
## 63: logical,integer,numeric,character,factor,ordered,...         1          1
## 64:                                      numeric,integer         1          1
##                                            feature_types input.num output.num
##     input.type.train  input.type.predict output.type.train output.type.predict
##  1:             Task                Task              Task                Task
##  2:                *                   *                 *                   *
##  3:             Task                Task              Task                Task
##  4:      TaskClassif         TaskClassif       TaskClassif         TaskClassif
##  5:             NULL   PredictionClassif              NULL   PredictionClassif
##  6:      TaskClassif         TaskClassif       TaskClassif         TaskClassif
##  7:             Task                Task              Task                Task
##  8:             Task                Task              Task                Task
##  9:             Task                Task              Task                Task
## 10:                *                   *                 *                   *
## 11:             Task                Task              Task                Task
## 12:             Task                Task              Task                Task
## 13:             Task                Task              Task                Task
## 14:             Task                Task              Task                Task
## 15:             Task                Task              Task                Task
## 16:             Task                Task              Task                Task
## 17:             Task                Task              Task                Task
## 18:             Task                Task              Task                Task
## 19:             Task                Task              Task                Task
## 20:             Task                Task              Task                Task
## 21:             Task                Task              Task                Task
## 22:             Task                Task              Task                Task
## 23:             Task                Task              Task                Task
## 24:             Task                Task              Task                Task
## 25:             Task                Task              Task                Task
## 26:             Task                Task              Task                Task
## 27:             Task                Task              Task                Task
## 28:             Task                Task              Task                Task
## 29:      TaskClassif         TaskClassif              NULL   PredictionClassif
## 30:      TaskClassif         TaskClassif       TaskClassif         TaskClassif
## 31:             Task                Task              Task                Task
## 32:             Task                Task              Task                Task
## 33:              [*]                 [*]                 *                   *
## 34:                *                   *               [*]                 [*]
## 35:             Task                Task              Task                Task
## 36:             Task                Task              Task                Task
## 37:                *                   *                 *                   *
## 38:      TaskClassif         TaskClassif     [TaskClassif]       [TaskClassif]
## 39:           [NULL] [PredictionClassif]              NULL   PredictionClassif
## 40:             Task                Task              Task                Task
## 41:                *                   *                 *                   *
## 42:             Task                Task              Task                Task
## 43:             Task                Task              Task                Task
## 44:             NULL          Prediction              NULL          Prediction
## 45:             NULL      PredictionRegr              NULL      PredictionRegr
## 46:             Task                Task              Task                Task
## 47:             Task                Task              Task                Task
## 48:                *                   *               [*]                 [*]
## 49:             Task                Task              Task                Task
## 50:             Task                Task              Task                Task
## 51:             Task                Task              Task                Task
## 52:             Task                Task              Task                Task
## 53:             Task                Task              Task                Task
## 54:             Task                Task              Task                Task
## 55:             Task                Task              Task                Task
## 56:        NULL,NULL function,Prediction              NULL          Prediction
## 57:             Task                Task         NULL,Task       function,Task
## 58:         TaskRegr            TaskRegr     NULL,TaskRegr   function,TaskRegr
## 59:             Task                Task              Task                Task
## 60:             NULL   PredictionClassif              NULL   PredictionClassif
## 61:             Task                Task              NULL          Prediction
## 62:                *                   *                 *                   *
## 63:             Task                Task              Task                Task
## 64:             Task                Task              Task                Task
##     input.type.train  input.type.predict output.type.train output.type.predict</code></pre>
<p>Single POs can be created using <code>po(&lt;name&gt;)</code>:</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span></code></pre></div>
<p>or using <strong>syntactic sugar</strong></p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span></code></pre></div>
<p>Some POs require additional arguments for construction:</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span><span class="op">)</span>

<span class="co"># Error in as_learner(learner) : argument "learner" is missing, with no default argument "learner" is missing, with no default</span></code></pre></div>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>, <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>or in short <code><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po("learner", lrn("classif.rpart"))</a></code>.</p>
<p>Hyperparameters of POs can be set through the <code>param_vals</code> argument.
Here we set the fraction of features for a filter:</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">filter</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"filter"</span>,
  filter <span class="op">=</span> <span class="fu">mlr3filters</span><span class="fu">::</span><span class="fu"><a href="https://mlr3filters.mlr-org.com/reference/flt.html">flt</a></span><span class="op">(</span><span class="st">"variance"</span><span class="op">)</span>,
  param_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>filter.frac <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>or in short notation:</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"filter"</span>, <span class="fu">mlr3filters</span><span class="fu">::</span><span class="fu"><a href="https://mlr3filters.mlr-org.com/reference/flt.html">flt</a></span><span class="op">(</span><span class="st">"variance"</span><span class="op">)</span>, filter.frac <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p>The figure below shows an exemplary <code>PipeOp</code>.
It takes an input, transforms it during <code>.$train</code> and <code>.$predict</code> and returns data:</p>
<div class="inline-figure"><img src="images/po_viz.png" width="464" style="display: block; margin: auto;"></div>

</div>
<div id="pipe-operator" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> The Pipeline Operator: <code>%&gt;&gt;%</code><a class="anchor" aria-label="anchor" href="#pipe-operator"><i class="fas fa-link"></i></a>
</h2>
<p>It is possible to create intricate <code>Graphs</code> with edges going all over the place (as long as no loops are introduced).
Irrespective, there is usually a clear direction of flow between “layers” in the <code>Graph</code>.
It is therefore convenient to build up a <code>Graph</code> from layers.
This can be done using the <strong><code><a href="https://mlr3pipelines.mlr-org.com//reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></code></strong> (“double-arrow”) operator.
It takes either a <code>PipeOp</code> or a <code>Graph</code> on each of its sides and connects all of the outputs of its left-hand side to one of the inputs each of its right-hand side.
The number of inputs therefore must match the number of outputs.</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://magrittr.tidyverse.org">"magrittr"</a></span><span class="op">)</span>

<span class="va">gr</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span>
<span class="va">gr</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-pipe-operator_files/figure-html/04-pipelines-pipe-operator-002-1.svg" width="672" style="display: block; margin: auto;"></div>

</div>
<div id="pipe-nodes-edges-graphs" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Nodes, Edges and Graphs<a class="anchor" aria-label="anchor" href="#pipe-nodes-edges-graphs"><i class="fas fa-link"></i></a>
</h2>
<p>POs are combined into <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a>s.
The manual way (= hard way) to construct a <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> is to create an empty graph first.
Then one fills the empty graph with POs, and connects edges between the POs.
Conceptually, this may look like this:</p>
<div class="inline-figure"><img src="images/po_nodes.svg" style="display: block; margin: auto;"></div>
<p>POs are identified by their <code>$id</code>.
Note that the operations all modify the object in-place and return the object itself.
Therefore, multiple modifications can be chained.</p>
<p>For this example we use the <code>pca</code> PO defined above and a new PO named “mutate”.
The latter creates a new feature from existing variables.
Additionally, we use the filter PO again.</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mutate</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"mutate"</span><span class="op">)</span>

<span class="va">filter</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"filter"</span>,
  filter <span class="op">=</span> <span class="fu">mlr3filters</span><span class="fu">::</span><span class="fu"><a href="https://mlr3filters.mlr-org.com/reference/flt.html">flt</a></span><span class="op">(</span><span class="st">"variance"</span><span class="op">)</span>,
  param_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>filter.frac <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span> <span class="op">=</span> <span class="va"><a href="https://mlr3pipelines.mlr-org.com//reference/Graph.html">Graph</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add_pipeop</span><span class="op">(</span><span class="va">mutate</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add_pipeop</span><span class="op">(</span><span class="va">filter</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add_edge</span><span class="op">(</span><span class="st">"mutate"</span>, <span class="st">"variance"</span><span class="op">)</span>  <span class="co"># add connection mutate -&gt; filter</span></code></pre></div>
<p>The much quicker way is to use the <code><a href="https://mlr3pipelines.mlr-org.com//reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></code> operator to chain POs or <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> s.
The same result as above can be achieved by doing the following:</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span> <span class="op">=</span> <span class="va">mutate</span> <span class="op">%&gt;&gt;%</span> <span class="va">filter</span></code></pre></div>
<p>Now the <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> can be inspected using its <code>$plot()</code> function:</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-nodes-edges-graphs_files/figure-html/04-pipelines-nodes-edges-graphs-006-1.svg" width="672" style="display: block; margin: auto;"></div>
<p><strong>Chaining multiple POs of the same kind</strong></p>
<p>If multiple POs of the same kind should be chained, it is necessary to change the <code>id</code> to avoid name clashes.
This can be done by either accessing the <code>$id</code> slot or during construction:</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span><span class="op">$</span><span class="fu">add_pipeop</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span><span class="op">$</span><span class="fu">add_pipeop</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span>, id <span class="op">=</span> <span class="st">"pca2"</span><span class="op">)</span><span class="op">)</span></code></pre></div>

</div>
<div id="pipe-modeling" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Modeling<a class="anchor" aria-label="anchor" href="#pipe-modeling"><i class="fas fa-link"></i></a>
</h2>
<p>The main purpose of a <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> is to build combined preprocessing and model fitting pipelines that can be used as <a href="https://mlr3.mlr-org.com">mlr3</a> <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a>.</p>
<p>Conceptually, the process may be summarized as follows:</p>
<div class="inline-figure"><img src="images/pipe_action.svg" style="display: block; margin: auto;"></div>
<p>In the following we chain two preprocessing tasks:</p>
<ul>
<li>mutate (creation of a new feature)</li>
<li>filter (filtering the dataset)</li>
</ul>
<p>Subsequently one can chain a PO learner to train and predict on the modified dataset.</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mutate</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"mutate"</span><span class="op">)</span>
<span class="va">filter</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"filter"</span>,
  filter <span class="op">=</span> <span class="fu">mlr3filters</span><span class="fu">::</span><span class="fu"><a href="https://mlr3filters.mlr-org.com/reference/flt.html">flt</a></span><span class="op">(</span><span class="st">"variance"</span><span class="op">)</span>,
  param_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>filter.frac <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>

<span class="va">graph</span> <span class="op">=</span> <span class="va">mutate</span> <span class="op">%&gt;&gt;%</span>
  <span class="va">filter</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>,
    learner <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Until here we defined the main pipeline stored in <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a>.
Now we can train and predict the pipeline:</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">graph</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></code></pre></div>
<pre><code>## $classif.rpart.output
## NULL</code></pre>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></code></pre></div>
<pre><code>## $classif.rpart.output
## &lt;PredictionClassif&gt; for 150 observations:
##     row_ids     truth  response
##           1    setosa    setosa
##           2    setosa    setosa
##           3    setosa    setosa
## ---                            
##         148 virginica virginica
##         149 virginica virginica
##         150 virginica virginica</code></pre>
<p>Rather than calling <code>$train()</code> and <code>$predict()</code> manually, we can put the pipeline <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> into a <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html"><code>GraphLearner</code></a> object.
A <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html"><code>GraphLearner</code></a> encapsulates the whole pipeline (including the preprocessing steps) and can be put into <a href="https://mlr3.mlr-org.com/reference/resample.html"><code>resample()</code></a> or <a href="https://mlr3.mlr-org.com/reference/benchmark.html"><code>benchmark()</code></a> .
If you are familiar with the old <em>mlr</em> package, this is the equivalent of all the <code>make*Wrapper()</code> functions.
The pipeline being encapsulated (here <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> ) must always produce a <a href="https://mlr3.mlr-org.com/reference/Prediction.html"><code>Prediction</code></a> with its <code>$predict()</code> call, so it will probably contain at least one <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_learner.html"><code>PipeOpLearner</code></a> .</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html">as_learner</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span></code></pre></div>
<p>This learner can be used for model fitting, resampling, benchmarking, and tuning:</p>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv3</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">task</span>, <span class="va">glrn</span>, <span class="va">cv3</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ResampleResult&gt; of 3 iterations
## * Task: iris
## * Learner: mutate.variance.classif.rpart
## * Warnings: 0 in 0 iterations
## * Errors: 0 in 0 iterations</code></pre>
<div id="pipe-hyperpars" class="section level3" number="5.4.1">
<h3>
<span class="header-section-number">5.4.1</span> Setting Hyperparameters<a class="anchor" aria-label="anchor" href="#pipe-hyperpars"><i class="fas fa-link"></i></a>
</h3>
<p>Individual POs offer hyperparameters because they contain <code>$param_set</code> slots that can be read and written from <code>$param_set$values</code> (via the paradox package).
The parameters get passed down to the <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a>, and finally to the <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html"><code>GraphLearner</code></a> .
This makes it not only possible to easily change the behavior of a <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> / <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html"><code>GraphLearner</code></a> and try different settings manually, but also to perform tuning using the <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a> package.</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glrn</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">variance.filter.frac</span> <span class="op">=</span> <span class="fl">0.25</span>
<span class="va">cv3</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">task</span>, <span class="va">glrn</span>, <span class="va">cv3</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ResampleResult&gt; of 3 iterations
## * Task: iris
## * Learner: mutate.variance.classif.rpart
## * Warnings: 0 in 0 iterations
## * Errors: 0 in 0 iterations</code></pre>
</div>
<div id="pipe-tuning" class="section level3" number="5.4.2">
<h3>
<span class="header-section-number">5.4.2</span> Tuning<a class="anchor" aria-label="anchor" href="#pipe-tuning"><i class="fas fa-link"></i></a>
</h3>
<p>If you are unfamiliar with tuning in <a href="https://mlr3.mlr-org.com">mlr3</a>, we recommend to take a look at the section about <a href="optimization.html#tuning">tuning</a> first.
Here we define a <a href="https://paradox.mlr-org.com/reference/ParamSet.html"><code>ParamSet</code></a> for the “rpart” learner and the “variance” filter which should be optimized during the tuning process.</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://paradox.mlr-org.com">"paradox"</a></span><span class="op">)</span>
<span class="va">ps</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html">ps</a></span><span class="op">(</span>
  classif.rpart.cp <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html">p_dbl</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,
  variance.filter.frac <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html">p_dbl</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">0.25</span>, upper <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>After having defined the <code>PerformanceEvaluator</code>, a random search with 10 iterations is created.
For the inner resampling, we are simply using holdout (single split into train/test) to keep the runtimes reasonable.</p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://mlr3tuning.mlr-org.com">"mlr3tuning"</a></span><span class="op">)</span>
<span class="va">instance</span> <span class="op">=</span> <span class="va"><a href="https://mlr3tuning.mlr-org.com/reference/TuningInstanceSingleCrit.html">TuningInstanceSingleCrit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  task <span class="op">=</span> <span class="va">task</span>,
  learner <span class="op">=</span> <span class="va">glrn</span>,
  resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span>,
  measure <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.ce"</span><span class="op">)</span>,
  search_space <span class="op">=</span> <span class="va">ps</span>,
  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tuner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3tuning.mlr-org.com/reference/tnr.html">tnr</a></span><span class="op">(</span><span class="st">"random_search"</span><span class="op">)</span>
<span class="va">tuner</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></code></pre></div>
<p>The tuning result can be found in the respective <code>result</code> slots.</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">instance</span><span class="op">$</span><span class="va">result_learner_param_vals</span>
<span class="va">instance</span><span class="op">$</span><span class="va">result_y</span></code></pre></div>

</div>
</div>
<div id="pipe-nonlinear" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Non-Linear Graphs<a class="anchor" aria-label="anchor" href="#pipe-nonlinear"><i class="fas fa-link"></i></a>
</h2>
<p>The Graphs seen so far all have a linear structure.
Some POs may have multiple input or output channels.
These channels make it possible to create non-linear Graphs with alternative paths taken by the data.</p>
<p>Possible types are:</p>
<ul>
<li>
<a href="pipelines.html#pipe-model-ensembles-branching-copying">Branching</a>:
Splitting of a node into several paths, e.g. useful when comparing multiple feature-selection methods (pca, filters).
Only one path will be executed.</li>
<li>
<a href="pipelines.html#pipe-model-ensembles-branching-copying">Copying</a>:
Splitting of a node into several paths, all paths will be executed (sequentially).
Parallel execution is not yet supported.</li>
<li>
<a href="pipelines.html#pipe-model-ensembles-stacking">Stacking</a>:
Single graphs are stacked onto each other, i.e. the output of one <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> is the input for another.
In machine learning this means that the prediction of one <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a> is used as input for another <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html"><code>Graph</code></a>
</li>
</ul>
<div id="pipe-model-ensembles-branching-copying" class="section level3" number="5.5.1">
<h3>
<span class="header-section-number">5.5.1</span> Branching &amp; Copying<a class="anchor" aria-label="anchor" href="#pipe-model-ensembles-branching-copying"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_branch.html"><code>PipeOpBranch</code></a> and <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_unbranch.html"><code>PipeOpUnbranch</code></a> POs make it possible to specify multiple alternative paths.
Only one path is actually executed, the others are ignored.
The active path is determined by a hyperparameter.
This concept makes it possible to tune alternative preprocessing paths (or learner models).</p>
<p>Below a conceptual visualization of branching:</p>
<div class="inline-figure"><img src="images/branching.svg" width="98%" style="display: block; margin: auto;"></div>
<p><code>PipeOp(Un)Branch</code> is initialized either with the number of branches, or with a <code>character</code>-vector indicating the names of the branches.
If names are given, the “branch-choosing” hyperparameter becomes more readable.
In the following, we set three options:</p>
<ol style="list-style-type: decimal">
<li>Doing nothing (“nop”)</li>
<li>Applying a PCA</li>
<li>Scaling the data</li>
</ol>
<p>It is important to “unbranch” again after “branching”, so that the outputs are merged into one result objects.</p>
<p>In the following we first create the branched graph and then show what happens if the “unbranching” is not applied:</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"branch"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nop"</span>, <span class="st">"pca"</span>, <span class="st">"scale"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/gunion.html">gunion</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"nop"</span>, id <span class="op">=</span> <span class="st">"null1"</span><span class="op">)</span>,
    <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span>,
    <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Without “unbranching” one creates the following graph:</p>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graph</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-non-linear_files/figure-html/04-pipelines-non-linear-004-1.svg" width="672" style="display: block; margin: auto;"></div>
<p>Now when “unbranching”, we obtain the following results:</p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">graph</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"unbranch"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nop"</span>, <span class="st">"pca"</span>, <span class="st">"scale"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-non-linear_files/figure-html/04-pipelines-non-linear-005-1.svg" width="672" style="display: block; margin: auto;"></div>
<p>The same can be achieved using a shorter notation:</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># List of pipeops</span>
<span class="va">opts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"nop"</span>, <span class="st">"no_op"</span><span class="op">)</span>, <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span>, <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># List of po ids</span>
<span class="va">opt_ids</span> <span class="op">=</span> <span class="fu">mlr3misc</span><span class="fu">::</span><span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/compat-map.html">map_chr</a></span><span class="op">(</span><span class="va">opts</span>, <span class="va">`[[`</span>, <span class="st">"id"</span><span class="op">)</span>
<span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"branch"</span>, options <span class="op">=</span> <span class="va">opt_ids</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/gunion.html">gunion</a></span><span class="op">(</span><span class="va">opts</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"unbranch"</span>, options <span class="op">=</span> <span class="va">opt_ids</span><span class="op">)</span></code></pre></div>
<pre><code>## Graph with 5 PipeOps:
##        ID         State        sccssors       prdcssors
##    branch &lt;&lt;UNTRAINED&gt;&gt; no_op,pca,scale                
##     no_op &lt;&lt;UNTRAINED&gt;&gt;        unbranch          branch
##       pca &lt;&lt;UNTRAINED&gt;&gt;        unbranch          branch
##     scale &lt;&lt;UNTRAINED&gt;&gt;        unbranch          branch
##  unbranch &lt;&lt;UNTRAINED&gt;&gt;                 no_op,pca,scale</code></pre>
</div>
<div id="pipe-model-ensembles" class="section level3" number="5.5.2">
<h3>
<span class="header-section-number">5.5.2</span> Model Ensembles<a class="anchor" aria-label="anchor" href="#pipe-model-ensembles"><i class="fas fa-link"></i></a>
</h3>
<p>We can leverage the different operations presented to connect POs.
This allows us to form powerful graphs.</p>
<p>Before we go into details, we split the task into train and test indices.</p>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">train.idx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">nrow</span><span class="op">)</span>, <span class="fl">120</span><span class="op">)</span>
<span class="va">test.idx</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">nrow</span><span class="op">)</span>, <span class="va">train.idx</span><span class="op">)</span></code></pre></div>
<div id="pipe-model-ensembles-bagging" class="section level4" number="5.5.2.1">
<h4>
<span class="header-section-number">5.5.2.1</span> Bagging<a class="anchor" aria-label="anchor" href="#pipe-model-ensembles-bagging"><i class="fas fa-link"></i></a>
</h4>
<p>We first examine Bagging introduced by <span class="citation">(<a href="references.html#ref-Breiman1996" role="doc-biblioref">Breiman 1996</a>)</span>.
The basic idea is to create multiple predictors and then aggregate those to a single, more powerful predictor.</p>
<blockquote>
<p>“… multiple versions are formed
by making bootstrap replicates of the learning set
and using these as new learning sets” <span class="citation">(<a href="references.html#ref-Breiman1996" role="doc-biblioref">Breiman 1996</a>)</span></p>
</blockquote>
<p>Bagging then aggregates a set of predictors by averaging (regression) or majority vote (classification).
The idea behind bagging is, that a set of weak, but different predictors can be combined in order to arrive at a single, better predictor.</p>
<p>We can achieve this by downsampling our data before training a learner, repeating this e.g. 10 times and then performing a majority vote on the predictions.
Graphically, it may be summarized as follows:</p>
<div class="inline-figure"><img src="images/nonlinear_pipeops.svg" style="display: block; margin: auto;"></div>
<p>First, we create a simple pipeline, that uses <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_subsample.html"><code>PipeOpSubsample</code></a> before a <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_learner.html"><code>PipeOpLearner</code></a> is trained:</p>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">single_pred</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"subsample"</span>, frac <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>, <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can now copy this operation 10 times using <a href="https://mlr3pipelines.mlr-org.com/reference/pipeline_greplicate.html"><code>pipeline_greplicate</code></a>.
The <a href="https://mlr3pipelines.mlr-org.com/reference/pipeline_greplicate.html"><code>pipeline_greplicate</code></a> allows us to parallelize many copies of an operation by creating a Graph containing <code>n</code> copies of the input Graph.
We can also create it using <strong>syntactic sugar</strong> via <code><a href="https://mlr3pipelines.mlr-org.com//reference/ppl.html">ppl()</a></code>:</p>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_set</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/ppl.html">ppl</a></span><span class="op">(</span><span class="st">"greplicate"</span>, <span class="va">single_pred</span>, <span class="fl">10L</span><span class="op">)</span></code></pre></div>
<p>Afterwards we need to aggregate the 10 pipelines to form a single model:</p>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bagging</span> <span class="op">=</span> <span class="va">pred_set</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"classifavg"</span>, innum <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>Now we can plot again to see what happens:</p>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bagging</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-non-linear_files/figure-html/04-pipelines-non-linear-012-1.svg" width="720" style="display: block; margin: auto;"></div>
<p>This pipeline can again be used in conjunction with <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html"><code>GraphLearner</code></a> in order for Bagging to be used like a <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a>:</p>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baglrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html">as_learner</a></span><span class="op">(</span><span class="va">bagging</span><span class="op">)</span>
<span class="va">baglrn</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span>, <span class="va">train.idx</span><span class="op">)</span>
<span class="va">baglrn</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span>, <span class="va">test.idx</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;PredictionClassif&gt; for 30 observations:
##     row_ids     truth   response prob.setosa prob.versicolor prob.virginica
##           8    setosa     setosa           1             0.0            0.0
##          16    setosa     setosa           1             0.0            0.0
##          20    setosa     setosa           1             0.0            0.0
## ---                                                                        
##         134 virginica versicolor           0             0.6            0.4
##         144 virginica  virginica           0             0.0            1.0
##         147 virginica  virginica           0             0.0            1.0</code></pre>
<p>In conjunction with different <code>Backends</code>, this can be a very powerful tool.
In cases when the data does not fully fit in memory, one can obtain a fraction of the data for each learner from a <a href="https://mlr3.mlr-org.com/reference/DataBackend.html"><code>DataBackend</code></a> and then aggregate predictions over all learners.</p>
</div>
<div id="pipe-model-ensembles-stacking" class="section level4" number="5.5.2.2">
<h4>
<span class="header-section-number">5.5.2.2</span> Stacking<a class="anchor" aria-label="anchor" href="#pipe-model-ensembles-stacking"><i class="fas fa-link"></i></a>
</h4>
<p>Stacking <span class="citation">(<a href="references.html#ref-Wolpert1992" role="doc-biblioref">Wolpert 1992</a>)</span> is another technique that can improve model performance.
The basic idea behind stacking is the use of predictions from one model as features for a subsequent model to possibly improve performance.</p>
<p>Below an conceptual illustration of stacking:</p>
<div class="inline-figure"><img src="images/stacking.svg" width="98%" style="display: block; margin: auto;"></div>
<p>As an example we can train a decision tree and use the predictions from this model in conjunction with the original features in order to train an additional model on top.</p>
<p>To limit overfitting, we additionally do not predict on the original predictions of the learner.
Instead, we predict on out-of-bag predictions.
To do all this, we can use <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_learner_cv.html"><code>PipeOpLearnerCV</code></a> .</p>
<p><a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_learner_cv.html"><code>PipeOpLearnerCV</code></a> performs nested cross-validation on the training data, fitting a model in each fold.
Each of the models is then used to predict on the out-of-fold data.
As a result, we obtain predictions for every data point in our input data.</p>
<p>We first create a “level 0” learner, which is used to extract a lower level prediction.
Additionally, we <code>clone()</code> the learner object to obtain a copy of the learner.
Subsequently, one sets a custom id for the <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html"><code>PipeOp</code></a> .</p>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span>
<span class="va">lrn_0</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner_cv"</span>, <span class="va">lrn</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">lrn_0</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="st">"rpart_cv"</span></code></pre></div>
<p>We use <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_nop.html"><code>PipeOpNOP</code></a> in combination with <a href="https://mlr3pipelines.mlr-org.com/reference/gunion.html"><code>gunion</code></a>, in order to send the unchanged Task to the next level.
There it is combined with the predictions from our decision tree learner.</p>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">level_0</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/gunion.html">gunion</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lrn_0</span>, <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"nop"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Afterwards, we want to concatenate the predictions from <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_learner_cv.html"><code>PipeOpLearnerCV</code></a> and the original Task using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_featureunion.html"><code>PipeOpFeatureUnion</code></a> :</p>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">combined</span> <span class="op">=</span> <span class="va">level_0</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"featureunion"</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Now we can train another learner on top of the combined features:</p>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stack</span> <span class="op">=</span> <span class="va">combined</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>, <span class="va">lrn</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">stack</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-non-linear_files/figure-html/04-pipelines-non-linear-018-1.svg" width="720" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stacklrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html">as_learner</a></span><span class="op">(</span><span class="va">stack</span><span class="op">)</span>
<span class="va">stacklrn</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span>, <span class="va">train.idx</span><span class="op">)</span>
<span class="va">stacklrn</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span>, <span class="va">test.idx</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;PredictionClassif&gt; for 30 observations:
##     row_ids     truth   response
##           8    setosa     setosa
##          16    setosa     setosa
##          20    setosa     setosa
## ---                             
##         134 virginica versicolor
##         144 virginica  virginica
##         147 virginica  virginica</code></pre>
<p>In this vignette, we showed a very simple use-case for stacking.
In many real-world applications, stacking is done for multiple levels and on multiple representations of the dataset.
On a lower level, different preprocessing methods can be defined in conjunction with several learners.
On a higher level, we can then combine those predictions in order to form a very powerful model.</p>
</div>
<div id="multilevel-stacking" class="section level4" number="5.5.2.3">
<h4>
<span class="header-section-number">5.5.2.3</span> Multilevel Stacking<a class="anchor" aria-label="anchor" href="#multilevel-stacking"><i class="fas fa-link"></i></a>
</h4>
<p>In order to showcase the power of <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a>, we will show a more complicated stacking example.</p>
<p>In this case, we train a <code>glmnet</code> and 2 different <code>rpart</code> models (some transform its inputs using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_pca.html"><code>PipeOpPCA</code></a> ) on our task in the “level 0” and concatenate them with the original features (via <a href="https://mlr3pipelines.mlr-org.com/reference/gunion.html"><code>gunion</code></a>).
The result is then passed on to “level 1”, where we copy the concatenated features 3 times and put this task into an <code>rpart</code> and a <code>glmnet</code> model.
Additionally, we keep a version of the “level 0” output (via <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_nop.html"><code>PipeOpNOP</code></a>) and pass this on to “level 2”.
In “level 2” we simply concatenate all “level 1” outputs and train a final decision tree.</p>
<p>In the following examples, use <code>&lt;lrn&gt;$param_set$values$&lt;param_name&gt; = &lt;param_value&gt;</code> to set hyperparameters
for the different learner.</p>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://magrittr.tidyverse.org">"magrittr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://mlr3learners.mlr-org.com">"mlr3learners"</a></span><span class="op">)</span> <span class="co"># for classif.glmnet</span>

<span class="va">rprt</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span>
<span class="va">glmn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.glmnet"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span>

<span class="co">#  Create Learner CV Operators</span>
<span class="va">lrn_0</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner_cv"</span>, <span class="va">rprt</span>, id <span class="op">=</span> <span class="st">"rpart_cv_1"</span><span class="op">)</span>
<span class="va">lrn_0</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">maxdepth</span> <span class="op">=</span> <span class="fl">5L</span>
<span class="va">lrn_1</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span>, id <span class="op">=</span> <span class="st">"pca1"</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner_cv"</span>, <span class="va">rprt</span>, id <span class="op">=</span> <span class="st">"rpart_cv_2"</span><span class="op">)</span>
<span class="va">lrn_1</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">rpart_cv_2.maxdepth</span> <span class="op">=</span> <span class="fl">1L</span>
<span class="va">lrn_2</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span>, id <span class="op">=</span> <span class="st">"pca2"</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner_cv"</span>, <span class="va">glmn</span><span class="op">)</span>

<span class="co"># Union them with a PipeOpNULL to keep original features</span>
<span class="va">level_0</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/gunion.html">gunion</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lrn_0</span>, <span class="va">lrn_1</span>, <span class="va">lrn_2</span>, <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"nop"</span>, id <span class="op">=</span> <span class="st">"NOP1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Cbind the output 3 times, train 2 learners but also keep level</span>
<span class="co"># 0 predictions</span>
<span class="va">level_1</span> <span class="op">=</span> <span class="va">level_0</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"featureunion"</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"copy"</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/gunion.html">gunion</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner_cv"</span>, <span class="va">rprt</span>, id <span class="op">=</span> <span class="st">"rpart_cv_l1"</span><span class="op">)</span>,
    <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner_cv"</span>, <span class="va">glmn</span>, id <span class="op">=</span> <span class="st">"glmnt_cv_l1"</span><span class="op">)</span>,
    <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"nop"</span>, id <span class="op">=</span> <span class="st">"NOP_l1"</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>

<span class="co"># Cbind predictions, train a final learner</span>
<span class="va">level_2</span> <span class="op">=</span> <span class="va">level_1</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"featureunion"</span>, <span class="fl">3</span>, id <span class="op">=</span> <span class="st">"u2"</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>, <span class="va">rprt</span>, id <span class="op">=</span> <span class="st">"rpart_l2"</span><span class="op">)</span>

<span class="co"># Plot the resulting graph</span>
<span class="va">level_2</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-non-linear_files/figure-html/04-pipelines-non-linear-020-1.svg" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">lrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html">as_learner</a></span><span class="op">(</span><span class="va">level_2</span><span class="op">)</span></code></pre></div>
<p>And we can again call <code>.$train</code> and <code>.$predict</code>:</p>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lrn</span><span class="op">$</span>
  <span class="fu">train</span><span class="op">(</span><span class="va">task</span>, <span class="va">train.idx</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">predict</span><span class="op">(</span><span class="va">task</span>, <span class="va">test.idx</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">score</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## classif.ce 
##    0.06667</code></pre>

</div>
</div>
</div>
<div id="pipe-special-ops" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> Special Operators<a class="anchor" aria-label="anchor" href="#pipe-special-ops"><i class="fas fa-link"></i></a>
</h2>
<p>This section introduces some special operators, that might be useful in numerous further applications.</p>
<div id="imputation-pipeopimpute" class="section level3" number="5.6.1">
<h3>
<span class="header-section-number">5.6.1</span> Imputation: <code>PipeOpImpute</code><a class="anchor" aria-label="anchor" href="#imputation-pipeopimpute"><i class="fas fa-link"></i></a>
</h3>
<p>An often occurring setting is the imputation of missing data.
Imputation methods range from relatively simple imputation using either <em>mean</em>, <em>median</em> or histograms to way more involved methods including using machine learning algorithms in order to predict missing values.</p>
<p>The following <code>PipeOp</code>s, <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOpImpute.html"><code>PipeOpImpute</code></a>:</p>
<ul>
<li>Impute numeric values from a histogram</li>
<li>Adds a new level for factors</li>
<li>Add a column marking whether a value for a given feature was missing or not (numeric only)</li>
<li>We use <code><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po("featureunion")</a></code> to cbind the missing indicator features.</li>
</ul>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pom</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"missind"</span><span class="op">)</span>
<span class="va">pon</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"imputehist"</span>, id <span class="op">=</span> <span class="st">"imputer_num"</span>, affect_columns <span class="op">=</span> <span class="va">is.numeric</span><span class="op">)</span>
<span class="va">pof</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"imputeoor"</span>, id <span class="op">=</span> <span class="st">"imputer_fct"</span>, affect_columns <span class="op">=</span> <span class="va">is.factor</span><span class="op">)</span>
<span class="va">imputer</span> <span class="op">=</span> <span class="va">pom</span> <span class="op">%&gt;&gt;%</span> <span class="va">pon</span> <span class="op">%&gt;&gt;%</span> <span class="va">pof</span></code></pre></div>
<p>A learner can thus be equipped with automatic imputation of missing values by adding an imputation Pipeop.</p>
<div class="sourceCode" id="cb384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>, <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span><span class="op">)</span>
<span class="va">lrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html">as_learner</a></span><span class="op">(</span><span class="va">imputer</span> <span class="op">%&gt;&gt;%</span> <span class="va">polrn</span><span class="op">)</span></code></pre></div>
</div>
<div id="feature-engineering-pipeopmutate" class="section level3" number="5.6.2">
<h3>
<span class="header-section-number">5.6.2</span> Feature Engineering: <code>PipeOpMutate</code><a class="anchor" aria-label="anchor" href="#feature-engineering-pipeopmutate"><i class="fas fa-link"></i></a>
</h3>
<p>New features can be added or computed from a task using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_mutate.html"><code>PipeOpMutate</code></a> .
The operator evaluates one or multiple expressions provided in an <code>alist</code>.
In this example, we compute some new features on top of the <code>iris</code> task.
Then we add them to the data as illustrated below:</p>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pom</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"mutate"</span><span class="op">)</span>

<span class="co"># Define a set of mutations</span>
<span class="va">mutations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  Sepal.Sum <span class="op">=</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">+</span> <span class="va">Sepal.Width</span>,
  Petal.Sum <span class="op">=</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>,
  Sepal.Petal.Ratio <span class="op">=</span> <span class="op">~</span> <span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">/</span> <span class="va">Petal.Length</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">pom</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">mutation</span> <span class="op">=</span> <span class="va">mutations</span></code></pre></div>
<p>If outside data is required, we can make use of the <code>env</code> parameter.
Moreover, we provide an environment, where expressions are evaluated (<code>env</code> defaults to <code>.GlobalEnv</code>).</p>
</div>
<div id="training-on-data-subsets-pipeopchunk" class="section level3" number="5.6.3">
<h3>
<span class="header-section-number">5.6.3</span> Training on data subsets: <code>PipeOpChunk</code><a class="anchor" aria-label="anchor" href="#training-on-data-subsets-pipeopchunk"><i class="fas fa-link"></i></a>
</h3>
<p>In cases, where data is too big to fit into the machine’s memory, an often-used technique is to split the data into several parts.
Subsequently, the parts are trained on each part of the data.</p>
<p>After undertaking these steps, we aggregate the models.
In this example, we split our data into 4 parts using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_chunk.html"><code>PipeOpChunk</code></a> .
Additionally, we create 4 <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_learner.html"><code>PipeOpLearner</code></a> POS, which are then trained on each split of the data.</p>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chks</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"chunk"</span>, <span class="fl">4</span><span class="op">)</span>
<span class="va">lrns</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/ppl.html">ppl</a></span><span class="op">(</span><span class="st">"greplicate"</span>, <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>, <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>Afterwards we can use <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_classifavg.html"><code>PipeOpClassifAvg</code></a> to aggregate the predictions from the 4 different models into a new one.</p>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mjv</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"classifavg"</span>, <span class="fl">4</span><span class="op">)</span></code></pre></div>
<p>We can now connect the different operators and visualize the full graph:</p>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pipeline</span> <span class="op">=</span> <span class="va">chks</span> <span class="op">%&gt;&gt;%</span> <span class="va">lrns</span> <span class="op">%&gt;&gt;%</span> <span class="va">mjv</span>
<span class="va">pipeline</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-special-pipeops_files/figure-html/04-pipelines-special-pipeops-007-1.svg" width="720" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">train.idx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">nrow</span><span class="op">)</span>, <span class="fl">120</span><span class="op">)</span>
<span class="va">test.idx</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">task</span><span class="op">$</span><span class="va">nrow</span><span class="op">)</span>, <span class="va">train.idx</span><span class="op">)</span>

<span class="va">pipelrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html">as_learner</a></span><span class="op">(</span><span class="va">pipeline</span><span class="op">)</span>
<span class="va">pipelrn</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span>, <span class="va">train.idx</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">predict</span><span class="op">(</span><span class="va">task</span>, <span class="va">train.idx</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">score</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## classif.ce 
##    0.05833</code></pre>
</div>
<div id="feature-selection-pipeopfilter-and-pipeopselect" class="section level3" number="5.6.4">
<h3>
<span class="header-section-number">5.6.4</span> Feature Selection: <code>PipeOpFilter</code> and <code>PipeOpSelect</code><a class="anchor" aria-label="anchor" href="#feature-selection-pipeopfilter-and-pipeopselect"><i class="fas fa-link"></i></a>
</h3>
<p>The package <a href="https://mlr3filters.mlr-org.com">mlr3filters</a> contains many different <a href="https://mlr3filters.mlr-org.com/reference/Filter.html"><code>mlr3filters::Filter</code></a>s that can be used to select features for subsequent learners.
This is often required when the data has a large amount of features.</p>
<p>A <code>PipeOp</code> for filters is <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_filter.html"><code>PipeOpFilter</code></a>:</p>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"filter"</span>, <span class="fu">mlr3filters</span><span class="fu">::</span><span class="fu"><a href="https://mlr3filters.mlr-org.com/reference/flt.html">flt</a></span><span class="op">(</span><span class="st">"information_gain"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## PipeOp: &lt;information_gain&gt; (not trained)
## values: &lt;list()&gt;
## Input channels &lt;name [train type, predict type]&gt;:
##   input [Task,Task]
## Output channels &lt;name [train type, predict type]&gt;:
##   output [Task,Task]</code></pre>
<p>How many features to keep can be set using <code>filter_nfeat</code>, <code>filter_frac</code> and <code>filter_cutoff</code>.</p>
<p>Filters can be selected / de-selected by name using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_select.html"><code>PipeOpSelect</code></a>.</p>

</div>
</div>
<div id="in-depth-pipelines" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> In-depth look into mlr3pipelines<a class="anchor" aria-label="anchor" href="#in-depth-pipelines"><i class="fas fa-link"></i></a>
</h2>
<p>This vignette is an in-depth introduction to <a href="https://cran.r-project.org/package=mlr3pipelines">mlr3pipelines</a>, the dataflow programming toolkit for machine learning in <code>R</code> using <a href="https://mlr3.mlr-org.com">mlr3</a>.
It will go through basic concepts and then give a few examples that both show the simplicity as well as the power and versatility of using <a href="https://cran.r-project.org/package=mlr3pipelines">mlr3pipelines</a>.</p>
<div id="whats-the-point" class="section level3" number="5.7.1">
<h3>
<span class="header-section-number">5.7.1</span> What’s the Point<a class="anchor" aria-label="anchor" href="#whats-the-point"><i class="fas fa-link"></i></a>
</h3>
<p>Machine learning toolkits often try to abstract away the processes happening inside machine learning algorithms.
This makes it easy for the user to switch out one algorithm for another without having to worry about what is happening inside it, what kind of data it is able to operate on etc.
The benefit of using <code>mlr3</code>, for example, is that one can create a <code>Learner</code>, a <code>Task</code>, a <code>Resampling</code> etc. and use them for typical machine learning operations.
It is trivial to exchange individual components and therefore use, for example, a different <code>Learner</code> in the same experiment for comparison.</p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_classif.html">as_task_classif</a></span><span class="op">(</span><span class="va">iris</span>, target <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span>
<span class="va">lrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span>
<span class="va">rsmp</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span>
<span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">task</span>, <span class="va">lrn</span>, <span class="va">rsmp</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ResampleResult&gt; of 1 iterations
## * Task: iris
## * Learner: classif.rpart
## * Warnings: 0 in 0 iterations
## * Errors: 0 in 0 iterations</code></pre>
<p>However, this modularity breaks down as soon as the learning algorithm encompasses more than just model fitting, like data preprocessing, ensembles or other meta models.
<a href="https://cran.r-project.org/package=mlr3pipelines">mlr3pipelines</a> takes modularity one step further than <code>mlr3</code>: it makes it possible to build individual steps within a <code>Learner</code> out of building blocks called <strong><code>PipeOp</code>s</strong>.</p>
</div>
<div id="pipeop-pipeline-operators" class="section level3" number="5.7.2">
<h3>
<span class="header-section-number">5.7.2</span> <code>PipeOp</code>: Pipeline Operators<a class="anchor" aria-label="anchor" href="#pipeop-pipeline-operators"><i class="fas fa-link"></i></a>
</h3>
<p>The most basic unit of functionality within <a href="https://cran.r-project.org/package=mlr3pipelines">mlr3pipelines</a> is the <strong><code>PipeOp</code></strong>, short for “pipeline operator”, which represents a trans-formative operation on input (for example a training dataset) leading to output.
It can therefore be seen as a generalized notion of a function, with a certain twist: <code>PipeOp</code>s behave differently during a “training phase” and a “prediction phase”.
The training phase will typically generate a certain model of the data that is saved as internal state.
The prediction phase will then operate on the input data depending on the trained model.</p>
<p>An example of this behavior is the <em>principal component analysis</em> operation (“<code>PipeOpPCA</code>”):
During training, it will transform incoming data by rotating it in a way that leads to uncorrelated features ordered by their contribution to total variance.
It will <em>also</em> save the rotation matrix to be used during for new data.
This makes it possible to perform “prediction” with single rows of new data, where a row’s scores on each of the principal components (the components of the training data!) is computed.</p>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">po</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span>
<span class="va">po</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##        Species    PC1      PC2      PC3       PC4
##   1:    setosa -2.684  0.31940 -0.02791 -0.002262
##   2:    setosa -2.714 -0.17700 -0.21046 -0.099027
##   3:    setosa -2.889 -0.14495  0.01790 -0.019968
##   4:    setosa -2.745 -0.31830  0.03156  0.075576
##   5:    setosa -2.729  0.32675  0.09008  0.061259
##  ---                                             
## 146: virginica  1.944  0.18753  0.17783 -0.426196
## 147: virginica  1.527 -0.37532 -0.12190 -0.254367
## 148: virginica  1.764  0.07886  0.13048 -0.137001
## 149: virginica  1.901  0.11663  0.72325 -0.044595
## 150: virginica  1.390 -0.28266  0.36291  0.155039</code></pre>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">single_line_task</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">po</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">single_line_task</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##    Species    PC1    PC2      PC3       PC4
## 1:  setosa -2.684 0.3194 -0.02791 -0.002262</code></pre>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">po</span><span class="op">$</span><span class="va">state</span></code></pre></div>
<pre><code>## Standard deviations (1, .., p=4):
## [1] 2.0563 0.4926 0.2797 0.1544
## 
## Rotation (n x k) = (4 x 4):
##                   PC1      PC2      PC3     PC4
## Petal.Length  0.85667 -0.17337  0.07624  0.4798
## Petal.Width   0.35829 -0.07548  0.54583 -0.7537
## Sepal.Length  0.36139  0.65659 -0.58203 -0.3155
## Sepal.Width  -0.08452  0.73016  0.59791  0.3197</code></pre>
<p>This shows the most important primitives incorporated in a <code>PipeOp</code>:
* <strong><code>$train()</code></strong>, taking a list of input arguments, turning them into a list of outputs, meanwhile saving a state in <code>$state</code>
* <strong><code>$predict()</code></strong>, taking a list of input arguments, turning them into a list of outputs, making use of the saved <code>$state</code>
* <strong><code>$state</code></strong>, the “model” trained with <code>$train()</code> and utilized during <code>$predict()</code>.</p>
<p>Schematically we can represent the <code>PipeOp</code> like so:</p>
<div class="inline-figure"><img src="images/po_viz.png" width="464" style="display: block; margin: auto;"></div>
<div id="why-the-state" class="section level4" number="5.7.2.1">
<h4>
<span class="header-section-number">5.7.2.1</span> Why the <code>$state</code><a class="anchor" aria-label="anchor" href="#why-the-state"><i class="fas fa-link"></i></a>
</h4>
<p>It is important to take a moment and notice the importance of a <code>$state</code> variable and the <code>$train()</code> / <code>$predict()</code> dichotomy in a <code>PipeOp</code>.
There are many preprocessing methods, for example scaling of parameters or imputation, that could in theory just be applied to training data and prediction / validation data separately, or they could be applied to a task before resampling is performed.
This would, however, be fallacious:</p>
<ul>
<li>The preprocessing of each instance of prediction data should not depend on the remaining prediction dataset.
A prediction on a single instance of new data should give the same result as prediction performed on a whole dataset.</li>
<li>If preprocessing is performed on a task <em>before</em> resampling is done, information about the test set can leak into the training set.
Resampling should evaluate the generalization performance of the <em>entire</em> machine learning method, therefore the behavior of this entire method must only depend only on the content of the <em>training</em> split during resampling.</li>
</ul>
</div>
<div id="where-to-get-pipeops" class="section level4" number="5.7.2.2">
<h4>
<span class="header-section-number">5.7.2.2</span> Where to Get <code>PipeOp</code>s<a class="anchor" aria-label="anchor" href="#where-to-get-pipeops"><i class="fas fa-link"></i></a>
</h4>
<p>Each <code>PipeOp</code> is an instance of an “<code>R6</code>” class, many of which are provided by the <a href="https://cran.r-project.org/package=mlr3pipelines">mlr3pipelines</a> package itself.
They can be constructed explicitly (“<code>PipeOpPCA$new()</code>”) or retrieved from the <code>mlr_pipeops</code> dictionary: <code><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po("pca")</a></code>.
The entire list of available <code>PipeOp</code>s, and some meta-information, can be retrieved using <code><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table()</a></code>:</p>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">mlr_pipeops</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"key"</span>, <span class="st">"input.num"</span>, <span class="st">"output.num"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>##                       key input.num output.num
##  1:                boxcox         1          1
##  2:                branch         1         NA
##  3:                 chunk         1         NA
##  4:        classbalancing         1          1
##  5:            classifavg        NA          1
##  6:          classweights         1          1
##  7:              colapply         1          1
##  8:       collapsefactors         1          1
##  9:              colroles         1          1
## 10:                  copy         1         NA
## 11:          datefeatures         1          1
## 12:                encode         1          1
## 13:          encodeimpact         1          1
## 14:            encodelmer         1          1
## 15:          featureunion        NA          1
## 16:                filter         1          1
## 17:            fixfactors         1          1
## 18:               histbin         1          1
## 19:                   ica         1          1
## 20:        imputeconstant         1          1
## 21:            imputehist         1          1
## 22:         imputelearner         1          1
## 23:            imputemean         1          1
## 24:          imputemedian         1          1
## 25:            imputemode         1          1
## 26:             imputeoor         1          1
## 27:          imputesample         1          1
## 28:             kernelpca         1          1
## 29:               learner         1          1
## 30:            learner_cv         1          1
## 31:               missind         1          1
## 32:           modelmatrix         1          1
## 33:     multiplicityexply         1         NA
## 34:     multiplicityimply        NA          1
## 35:                mutate         1          1
## 36:                   nmf         1          1
## 37:                   nop         1          1
## 38:              ovrsplit         1          1
## 39:              ovrunite         1          1
## 40:                   pca         1          1
## 41:                 proxy        NA          1
## 42:           quantilebin         1          1
## 43:      randomprojection         1          1
## 44:        randomresponse         1          1
## 45:               regravg        NA          1
## 46:       removeconstants         1          1
## 47:         renamecolumns         1          1
## 48:             replicate         1          1
## 49:                 scale         1          1
## 50:           scalemaxabs         1          1
## 51:            scalerange         1          1
## 52:                select         1          1
## 53:                 smote         1          1
## 54:           spatialsign         1          1
## 55:             subsample         1          1
## 56:          targetinvert         2          1
## 57:          targetmutate         1          2
## 58: targettrafoscalerange         1          2
## 59:        textvectorizer         1          1
## 60:             threshold         1          1
## 61:         tunethreshold         1          1
## 62:              unbranch        NA          1
## 63:                vtreat         1          1
## 64:            yeojohnson         1          1
##                       key input.num output.num</code></pre>
<p>When retrieving <code>PipeOp</code>s from the <code>mlr_pipeops</code> dictionary, it is also possible to give additional constructor arguments, such as an <a href="pipelines.html#pipeop-ids-and-id-name-clashes">id</a> or <a href="pipelines.html#hyperparameters">parameter values</a>.</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span>, rank. <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## PipeOp: &lt;pca&gt; (not trained)
## values: &lt;rank.=3&gt;
## Input channels &lt;name [train type, predict type]&gt;:
##   input [Task,Task]
## Output channels &lt;name [train type, predict type]&gt;:
##   output [Task,Task]</code></pre>
</div>
</div>
<div id="pipeop-channels" class="section level3" number="5.7.3">
<h3>
<span class="header-section-number">5.7.3</span> PipeOp Channels<a class="anchor" aria-label="anchor" href="#pipeop-channels"><i class="fas fa-link"></i></a>
</h3>
<div id="input-channels" class="section level4" number="5.7.3.1">
<h4>
<span class="header-section-number">5.7.3.1</span> Input Channels<a class="anchor" aria-label="anchor" href="#input-channels"><i class="fas fa-link"></i></a>
</h4>
<p>Just like functions, <code>PipeOp</code>s can take multiple inputs.
These multiple inputs are always given as elements in the input list.
For example, there is a <code>PipeOpFeatureUnion</code> that combines multiple tasks with different features and “<code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>s” them together, creating one combined task.
When two halves of the <code>iris</code> task are given, for example, it recreates the original task:</p>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris_first_half</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span><span class="op">)</span><span class="op">)</span>
<span class="va">iris_second_half</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span><span class="op">)</span><span class="op">)</span>

<span class="va">pofu</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"featureunion"</span>, innum <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">pofu</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">iris_first_half</span>, <span class="va">iris_second_half</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##        Species Petal.Length Petal.Width Sepal.Length Sepal.Width
##   1:    setosa          1.4         0.2          5.1         3.5
##   2:    setosa          1.4         0.2          4.9         3.0
##   3:    setosa          1.3         0.2          4.7         3.2
##   4:    setosa          1.5         0.2          4.6         3.1
##   5:    setosa          1.4         0.2          5.0         3.6
##  ---                                                            
## 146: virginica          5.2         2.3          6.7         3.0
## 147: virginica          5.0         1.9          6.3         2.5
## 148: virginica          5.2         2.0          6.5         3.0
## 149: virginica          5.4         2.3          6.2         3.4
## 150: virginica          5.1         1.8          5.9         3.0</code></pre>
<p>Because <code>PipeOpFeatureUnion</code> effectively takes two input arguments here, we can say it has two <strong>input channels</strong>.
An input channel also carries information about the <em>type</em> of input that is acceptable.
The input channels of the <code>pofu</code> object constructed above, for example, each accept a <code>Task</code> during training and prediction.
This information can be queried from the <code>$input</code> slot:</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pofu</span><span class="op">$</span><span class="va">input</span></code></pre></div>
<pre><code>##      name train predict
## 1: input1  Task    Task
## 2: input2  Task    Task</code></pre>
<p>Other <code>PipeOp</code>s may have channels that take different types during different phases.
The <code>backuplearner</code> <code>PipeOp</code>, for example, takes a <code>NULL</code> and a <code>Task</code> during training, and a <code>Prediction</code> and a <code>Task</code> during prediction:</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## TODO this is an important case to handle here, do not delete unless there is a better example.</span>
<span class="co">## po("backuplearner")$input</span></code></pre></div>
</div>
<div id="output-channels" class="section level4" number="5.7.3.2">
<h4>
<span class="header-section-number">5.7.3.2</span> Output Channels<a class="anchor" aria-label="anchor" href="#output-channels"><i class="fas fa-link"></i></a>
</h4>
<p>Unlike the typical notion of a function, <code>PipeOp</code>s can also have multiple <strong>output channels</strong>.
<code>$train()</code> and <code>$predict()</code> always return a list, so certain <code>PipeOp</code>s may return lists with more than one element.
Similar to input channels, the information about the number and type of outputs given by a <code>PipeOp</code> is available in the <code>$output</code> slot.
The <code>chunk</code> PipeOp, for example, chunks a given <code>Task</code> into subsets and consequently returns multiple <code>Task</code> objects, both during training and prediction.
The number of output channels must be given during construction through the <code>outnum</code> argument.</p>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"chunk"</span>, outnum <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">$</span><span class="va">output</span></code></pre></div>
<pre><code>##       name train predict
## 1: output1  Task    Task
## 2: output2  Task    Task
## 3: output3  Task    Task</code></pre>
<p>Note that the number of output channels during training and prediction is the same.
A schema of a <code>PipeOp</code> with two output channels:</p>
<div class="inline-figure"><img src="images/po_multi_alone.png" width="282" style="display: block; margin: auto;"></div>
</div>
<div id="channel-configuration" class="section level4" number="5.7.3.3">
<h4>
<span class="header-section-number">5.7.3.3</span> Channel Configuration<a class="anchor" aria-label="anchor" href="#channel-configuration"><i class="fas fa-link"></i></a>
</h4>
<p>Most <code>PipeOp</code>s have only one input channel (so they take a list with a single element), but there are a few with more than one;
In many cases, the number of input or output channels is determined during construction, e.g. through the <code>innum</code> / <code>outnum</code> arguments.
The <code>input.num</code> and <code>output.num</code> columns of the <code>mlr_pipeops</code>-table <a href="pipelines.html#where-to-get-pipeops">above</a> show the default number of channels, and <code>NA</code> if the number depends on a construction argument.</p>
<p>The default printer of a <code>PipeOp</code> gives information about channel names and types:</p>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## po("backuplearner")</span></code></pre></div>
</div>
</div>
<div id="graph-networks-of-pipeops" class="section level3" number="5.7.4">
<h3>
<span class="header-section-number">5.7.4</span> <code>Graph</code>: Networks of <code>PipeOp</code>s<a class="anchor" aria-label="anchor" href="#graph-networks-of-pipeops"><i class="fas fa-link"></i></a>
</h3>
<div id="basics-1" class="section level4" number="5.7.4.1">
<h4>
<span class="header-section-number">5.7.4.1</span> Basics<a class="anchor" aria-label="anchor" href="#basics-1"><i class="fas fa-link"></i></a>
</h4>
<p>What is the advantage of this tedious way of declaring input and output channels and handling in/output through lists?
Because each <code>PipeOp</code> has a known number of input and output channels that always produce or accept data of a known type, it is possible to network them together in <strong><code>Graph</code></strong>s.
A <code>Graph</code> is a collection of <code>PipeOp</code>s with “edges” that mandate that data should be flowing along them.
Edges always pass between <code>PipeOp</code> <em>channels</em>, so it is not only possible to explicitly prescribe which position of an input or output list an edge refers to, it makes it possible to make different components of a <code>PipeOp</code>’s output flow to multiple different other <code>PipeOp</code>s, as well as to have a <code>PipeOp</code> gather its input from multiple other <code>PipeOp</code>s.</p>
<p>A schema of a simple graph of <code>PipeOp</code>s:</p>
<div class="inline-figure"><img src="images/po_multi_viz.png" width="430" style="display: block; margin: auto;"></div>
<p>A <code>Graph</code> is empty when first created, and <code>PipeOp</code>s can be added using the <strong><code>$add_pipeop()</code></strong> method.
The <strong><code>$add_edge()</code></strong> method is used to create connections between them.
While the printer of a <code>Graph</code> gives some information about its layout, the most intuitive way of visualizing it is using the <code>$plot()</code> function.</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span> <span class="op">=</span> <span class="va"><a href="https://mlr3pipelines.mlr-org.com//reference/Graph.html">Graph</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">gr</span><span class="op">$</span><span class="fu">add_pipeop</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span><span class="op">)</span>
<span class="va">gr</span><span class="op">$</span><span class="fu">add_pipeop</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"subsample"</span>, frac <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">gr</span><span class="op">$</span><span class="fu">add_edge</span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"subsample"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span></code></pre></div>
<pre><code>## Graph with 2 PipeOps:
##         ID         State  sccssors prdcssors
##      scale &lt;&lt;UNTRAINED&gt;&gt; subsample          
##  subsample &lt;&lt;UNTRAINED&gt;&gt;               scale</code></pre>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-in-depth_files/figure-html/04-pipelines-in-depth-018-1.svg" width="768" style="display: block; margin: auto;"></div>
<p>A <code>Graph</code> itself has a <strong><code>$train()</code></strong> and a <strong><code>$predict()</code></strong> method that accept some data and propagate this data through the network of <code>PipeOp</code>s.
The return value corresponds to the output of the <code>PipeOp</code> output channels that are not connected to other <code>PipeOp</code>s.</p>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##        Species Petal.Length Petal.Width Sepal.Length Sepal.Width
##  1:     setosa     -1.39240     -1.0487     -0.53538     1.93331
##  2:     setosa     -1.27910     -1.3111     -1.13920     0.09789
##  3:     setosa     -1.39240     -1.3111     -1.74302    -0.13154
##  4: versicolor      0.08044      0.2633     -0.77691    -0.81982
##  5: versicolor      0.25038      0.3945      0.06843    -0.13154
##  6: versicolor      0.13709      0.1321      0.30996    -0.59040
##  7: versicolor      0.19373      0.1321     -0.29386    -0.13154
##  8: versicolor      0.25038      0.1321     -0.29386    -0.81982
##  9:  virginica      0.76021      0.9192     -0.05233    -0.81982
## 10:  virginica      1.32669      1.7064      1.63836     1.24503
## 11:  virginica      0.70356      1.0504     -0.17309    -1.27868
## 12:  virginica      1.66657      1.0504      2.24217    -0.59040
## 13:  virginica      1.04345      1.1816      0.67225    -0.59040
## 14:  virginica      1.04345      1.3128      0.67225    -0.59040
## 15:  virginica      0.93015      1.1816      1.27607     0.09789</code></pre>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">single_line_task</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##    Species Petal.Length Petal.Width Sepal.Length Sepal.Width
## 1:  setosa       -1.336      -1.311      -0.8977       1.016</code></pre>
<p>The collection of <code>PipeOp</code>s inside a <code>Graph</code> can be accessed through the <strong><code>$pipeops</code></strong> slot.
The set of edges in the Graph can be inspected through the <strong><code>$edges</code></strong> slot.
It is possible to modify individual <code>PipeOps</code> and edges in a Graph through these slots, but this is not recommended because no error checking is performed and it may put the <code>Graph</code> in an unsupported state.</p>
</div>
<div id="networks" class="section level4" number="5.7.4.2">
<h4>
<span class="header-section-number">5.7.4.2</span> Networks<a class="anchor" aria-label="anchor" href="#networks"><i class="fas fa-link"></i></a>
</h4>
<p>The example above showed a linear preprocessing pipeline, but it is in fact possible to build true “graphs” of operations, as long as no loops are introduced<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;It is tempting to denote this as a “directed acyclic graph”, but this would not be entirely correct because edges run between channels of &lt;code&gt;PipeOp&lt;/code&gt;s, not &lt;code&gt;PipeOp&lt;/code&gt;s themselves.&lt;/p&gt;"><sup>1</sup></a>.
<code>PipeOp</code>s with multiple output channels can feed their data to multiple different subsequent <code>PipeOp</code>s, and <code>PipeOp</code>s with multiple input channels can take results from different <code>PipeOp</code>s.
When a <code>PipeOp</code> has more than one input / output channel, then the <code>Graph</code>’s <code>$add_edge()</code> method needs an additional argument that indicates which channel to connect to.
This argument can be given in the form of an integer, or as the name of the channel.</p>
<p>The following constructs a <code>Graph</code> that copies the input and gives one copy each to a “scale” and a “pca” <code>PipeOp</code>.
The resulting columns of each operation are put next to each other by “featureunion”.</p>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span> <span class="op">=</span> <span class="va"><a href="https://mlr3pipelines.mlr-org.com//reference/Graph.html">Graph</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add_pipeop</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"copy"</span>, outnum <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add_pipeop</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add_pipeop</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add_pipeop</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"featureunion"</span>, innum <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="va">gr</span><span class="op">$</span>
  <span class="fu">add_edge</span><span class="op">(</span><span class="st">"copy"</span>, <span class="st">"scale"</span>, src_channel <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span>        <span class="co"># designating channel by index</span>
  <span class="fu">add_edge</span><span class="op">(</span><span class="st">"copy"</span>, <span class="st">"pca"</span>, src_channel <span class="op">=</span> <span class="st">"output2"</span><span class="op">)</span><span class="op">$</span>  <span class="co"># designating channel by name</span>
  <span class="fu">add_edge</span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"featureunion"</span>, dst_channel <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add_edge</span><span class="op">(</span><span class="st">"pca"</span>, <span class="st">"featureunion"</span>, dst_channel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">gr</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-in-depth_files/figure-html/04-pipelines-in-depth-021-1.svg" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">iris_first_half</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##        Species Petal.Length Petal.Width    PC1       PC2
##   1:    setosa      -1.3358     -1.3111 -2.561 -0.006922
##   2:    setosa      -1.3358     -1.3111 -2.561 -0.006922
##   3:    setosa      -1.3924     -1.3111 -2.653  0.031850
##   4:    setosa      -1.2791     -1.3111 -2.469 -0.045694
##   5:    setosa      -1.3358     -1.3111 -2.561 -0.006922
##  ---                                                    
## 146: virginica       0.8169      1.4440  1.756  0.455479
## 147: virginica       0.7036      0.9192  1.417  0.164312
## 148: virginica       0.8169      1.0504  1.640  0.178946
## 149: virginica       0.9302      1.4440  1.940  0.377936
## 150: virginica       0.7602      0.7880  1.470  0.033362</code></pre>
</div>
<div id="syntactic-sugar" class="section level4" number="5.7.4.3">
<h4>
<span class="header-section-number">5.7.4.3</span> Syntactic Sugar<a class="anchor" aria-label="anchor" href="#syntactic-sugar"><i class="fas fa-link"></i></a>
</h4>
<p>Although it is possible to create intricate <code>Graphs</code> with edges going all over the place (as long as no loops are introduced), there is usually a clear direction of flow between “layers” in the <code>Graph</code>.
It is therefore convenient to build up a <code>Graph</code> from layers, which can be done using the <strong><code><a href="https://mlr3pipelines.mlr-org.com//reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></code></strong> (“double-arrow”) operator.
It takes either a <code>PipeOp</code> or a <code>Graph</code> on each of its sides and connects all of the outputs of its left-hand side to one of the inputs each of its right-hand side–the number of inputs therefore must match the number of outputs.
Together with the <strong><code><a href="https://mlr3pipelines.mlr-org.com//reference/gunion.html">gunion()</a></code></strong> operation, which takes <code>PipeOp</code>s or <code>Graph</code>s and arranges them next to each other akin to a (disjoint) graph union, the above network can more easily be constructed as follows:</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"copy"</span>, outnum <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/gunion.html">gunion</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span>, <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span>
  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"featureunion"</span>, innum <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">gr</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>html <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="05-pipelines-in-depth_files/figure-html/04-pipelines-in-depth-023-1.svg" width="672" style="display: block; margin: auto;"></div>
</div>
<div id="pipeop-ids-and-id-name-clashes" class="section level4" number="5.7.4.4">
<h4>
<span class="header-section-number">5.7.4.4</span> <code>PipeOp</code> IDs and ID Name Clashes<a class="anchor" aria-label="anchor" href="#pipeop-ids-and-id-name-clashes"><i class="fas fa-link"></i></a>
</h4>
<p><code>PipeOp</code>s within a graph are addressed by their <strong><code>$id</code></strong>-slot.
It is therefore necessary for all <code>PipeOp</code>s within a <code>Graph</code> to have a unique <code>$id</code>.
The <code>$id</code> can be set during or after construction, but it should not directly be changed after a <code>PipeOp</code> was inserted in a <code>Graph</code>.
At that point, the <strong><code>$set_names()</code></strong>-method can be used to change <code>PipeOp</code> ids.</p>
<div class="sourceCode" id="cb425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">po1</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span>
<span class="va">po2</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span>
<span class="va">po1</span> <span class="op">%&gt;&gt;%</span> <span class="va">po2</span>  <span class="co">## name clash</span></code></pre></div>
<pre><code>## Error in gunion(list(g1, g2)): Assertion on 'ids of pipe operators' failed: Must have unique names, but element 2 is duplicated.</code></pre>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">po2</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="st">"scale2"</span>
<span class="va">gr</span> <span class="op">=</span> <span class="va">po1</span> <span class="op">%&gt;&gt;%</span> <span class="va">po2</span>
<span class="va">gr</span></code></pre></div>
<pre><code>## Graph with 2 PipeOps:
##      ID         State sccssors prdcssors
##   scale &lt;&lt;UNTRAINED&gt;&gt;   scale2          
##  scale2 &lt;&lt;UNTRAINED&gt;&gt;              scale</code></pre>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Alternative ways of getting new ids:</span>
<span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span>, id <span class="op">=</span> <span class="st">"scale2"</span><span class="op">)</span></code></pre></div>
<pre><code>## PipeOp: &lt;scale2&gt; (not trained)
## values: &lt;robust=FALSE&gt;
## Input channels &lt;name [train type, predict type]&gt;:
##   input [Task,Task]
## Output channels &lt;name [train type, predict type]&gt;:
##   output [Task,Task]</code></pre>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span>, id <span class="op">=</span> <span class="st">"scale2"</span><span class="op">)</span></code></pre></div>
<pre><code>## PipeOp: &lt;scale2&gt; (not trained)
## values: &lt;robust=FALSE&gt;
## Input channels &lt;name [train type, predict type]&gt;:
##   input [Task,Task]
## Output channels &lt;name [train type, predict type]&gt;:
##   output [Task,Task]</code></pre>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## sometimes names of PipeOps within a Graph need to be changed</span>
<span class="va">gr2</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span>
<span class="va">gr</span> <span class="op">%&gt;&gt;%</span> <span class="va">gr2</span></code></pre></div>
<pre><code>## Error in gunion(list(g1, g2)): Assertion on 'ids of pipe operators' failed: Must have unique names, but element 3 is duplicated.</code></pre>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr2</span><span class="op">$</span><span class="fu">set_names</span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"scale3"</span><span class="op">)</span>
<span class="va">gr</span> <span class="op">%&gt;&gt;%</span> <span class="va">gr2</span></code></pre></div>
<pre><code>## Graph with 4 PipeOps:
##      ID         State sccssors prdcssors
##   scale &lt;&lt;UNTRAINED&gt;&gt;   scale2          
##  scale2 &lt;&lt;UNTRAINED&gt;&gt;   scale3     scale
##  scale3 &lt;&lt;UNTRAINED&gt;&gt;      pca    scale2
##     pca &lt;&lt;UNTRAINED&gt;&gt;             scale3</code></pre>
</div>
</div>
<div id="learners-in-graphs-graphs-in-learners" class="section level3" number="5.7.5">
<h3>
<span class="header-section-number">5.7.5</span> Learners in Graphs, Graphs in Learners<a class="anchor" aria-label="anchor" href="#learners-in-graphs-graphs-in-learners"><i class="fas fa-link"></i></a>
</h3>
<p>The true power of <a href="https://cran.r-project.org/package=mlr3pipelines">mlr3pipelines</a> derives from the fact that it can be integrated seamlessly with <code>mlr3</code>.
Two components are mainly responsible for this:</p>
<ul>
<li>
<strong><code>PipeOpLearner</code></strong>, a <code>PipeOp</code> that encapsulates a <code>mlr3</code> <code>Learner</code> and creates a <code>PredictionData</code> object in its <code>$predict()</code> phase</li>
<li>
<strong><code>GraphLearner</code></strong>, a <code>mlr3</code> <code>Learner</code> that can be used in place of any other <code>mlr3</code> <code>Learner</code>, but which does prediction using a <code>Graph</code> given to it</li>
</ul>
<p>Note that these are dual to each other: One takes a <code>Learner</code> and produces a <code>PipeOp</code> (and by extension a <code>Graph</code>); the other takes a <code>Graph</code> and produces a <code>Learner</code>.</p>
<div id="pipeoplearner" class="section level4" number="5.7.5.1">
<h4>
<span class="header-section-number">5.7.5.1</span> <code>PipeOpLearner</code><a class="anchor" aria-label="anchor" href="#pipeoplearner"><i class="fas fa-link"></i></a>
</h4>
<p>The <code>PipeOpLearner</code> is constructed using a <code>mlr3</code> <code>Learner</code> and will use it to create <code>PredictionData</code> in the <code>$predict()</code> phase.
The output during <code>$train()</code> is <code>NULL</code>.
It can be used after a preprocessing pipeline, and it is even possible to perform operations on the <code>PredictionData</code>, for example by averaging multiple predictions or by using the “<code>PipeOpBackupLearner</code>” operator to impute predictions that a given model failed to create.</p>
<p>The following is a very simple <code>Graph</code> that performs training and prediction on data after performing principal component analysis.</p>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>,
  <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></code></pre></div>
<pre><code>## $classif.rpart.output
## NULL</code></pre>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></code></pre></div>
<pre><code>## $classif.rpart.output
## &lt;PredictionClassif&gt; for 150 observations:
##     row_ids     truth  response
##           1    setosa    setosa
##           2    setosa    setosa
##           3    setosa    setosa
## ---                            
##         148 virginica virginica
##         149 virginica virginica
##         150 virginica virginica</code></pre>
</div>
<div id="graphlearner" class="section level4" number="5.7.5.2">
<h4>
<span class="header-section-number">5.7.5.2</span> <code>GraphLearner</code><a class="anchor" aria-label="anchor" href="#graphlearner"><i class="fas fa-link"></i></a>
</h4>
<p>Although a <code>Graph</code> has <code>$train()</code> and <code>$predict()</code> functions, it can not be used directly in places where <code>mlr3</code> <code>Learners</code> can be used like resampling or benchmarks.
For this, it needs to be wrapped in a <code>GraphLearner</code> object, which is a thin wrapper that enables this functionality.
The resulting <code>Learner</code> is extremely versatile, because every part of it can be modified, replaced, parameterized and optimized over.
Resampling the graph above can be done the same way that resampling of the <code>Learner</code> was performed in the <a href="pipelines.html#whats-the-point">introductory example</a>.</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lrngrph</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html">as_learner</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span>
<span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">task</span>, <span class="va">lrngrph</span>, <span class="va">rsmp</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ResampleResult&gt; of 1 iterations
## * Task: iris
## * Learner: pca.classif.rpart
## * Warnings: 0 in 0 iterations
## * Errors: 0 in 0 iterations</code></pre>
</div>
</div>
<div id="hyperparameters" class="section level3" number="5.7.6">
<h3>
<span class="header-section-number">5.7.6</span> Hyperparameters<a class="anchor" aria-label="anchor" href="#hyperparameters"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://cran.r-project.org/package=mlr3pipelines">mlr3pipelines</a> relies on the <a href="https://paradox.mlr-org.com"><code>paradox</code></a> package to provide parameters that can modify each <code>PipeOp</code>’s behavior.
<code>paradox</code> parameters provide information about the parameters that can be changed, as well as their types and ranges.
They provide a unified interface for benchmarks and parameter optimization (“tuning”).
For a deep dive into <code>paradox</code>, see <a href="optimization.html#searchspace">the tuning chapter</a> or the <a href="technical.html#paradox">in-depth <code>paradox</code> chapter</a>.</p>
<p>The <code>ParamSet</code>, representing the space of possible parameter configurations of a <code>PipeOp</code>, can be inspected by accessing the <strong><code>$param_set</code></strong> slot of a <code>PipeOp</code> or a <code>Graph</code>.</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op_pca</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span>
<span class="va">op_pca</span><span class="op">$</span><span class="va">param_set</span></code></pre></div>
<pre><code>## &lt;ParamSet:pca&gt;
##                id    class lower upper nlevels       default value
## 1:         center ParamLgl    NA    NA       2          TRUE      
## 2:         scale. ParamLgl    NA    NA       2         FALSE      
## 3:          rank. ParamInt     1   Inf     Inf                    
## 4: affect_columns ParamUty    NA    NA     Inf &lt;Selector[1]&gt;</code></pre>
<p>To set or retrieve a parameter, the <strong><code>$param_set$values</code></strong> slot can be accessed.
Alternatively, the <code>param_vals</code> value can be given during construction.</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op_pca</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">center</span> <span class="op">=</span> <span class="cn">FALSE</span>
<span class="va">op_pca</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></code></pre></div>
<pre><code>## $center
## [1] FALSE</code></pre>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op_pca</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">op_pca</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></code></pre></div>
<pre><code>## $center
## [1] TRUE</code></pre>
<p>Each <code>PipeOp</code> can bring its own individual parameters which are collected together in the <code>Graph</code>’s <code>$param_set</code>.
A <code>PipeOp</code>’s parameter names are prefixed with its <code>$id</code> to prevent parameter name clashes.</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span> <span class="op">=</span> <span class="va">op_pca</span> <span class="op">%&gt;&gt;%</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span>
<span class="va">gr</span><span class="op">$</span><span class="va">param_set</span></code></pre></div>
<pre><code>## &lt;ParamSetCollection&gt;
##                      id    class lower upper nlevels        default value
## 1:           pca.center ParamLgl    NA    NA       2           TRUE  TRUE
## 2:           pca.scale. ParamLgl    NA    NA       2          FALSE      
## 3:            pca.rank. ParamInt     1   Inf     Inf                     
## 4:   pca.affect_columns ParamUty    NA    NA     Inf  &lt;Selector[1]&gt;      
## 5:         scale.center ParamLgl    NA    NA       2           TRUE      
## 6:          scale.scale ParamLgl    NA    NA       2           TRUE      
## 7:         scale.robust ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt; FALSE
## 8: scale.affect_columns ParamUty    NA    NA     Inf  &lt;Selector[1]&gt;</code></pre>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gr</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></code></pre></div>
<pre><code>## $pca.center
## [1] TRUE
## 
## $scale.robust
## [1] FALSE</code></pre>
<p>Both <code>PipeOpLearner</code> and <code>GraphLearner</code> preserve parameters of the objects they encapsulate.</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span><span class="op">(</span><span class="st">"learner"</span>, <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span><span class="op">)</span>
<span class="va">op_rpart</span><span class="op">$</span><span class="va">param_set</span></code></pre></div>
<pre><code>## &lt;ParamSet:classif.rpart&gt;
##                 id    class lower upper nlevels        default value
##  1:             cp ParamDbl     0     1     Inf           0.01      
##  2:     keep_model ParamLgl    NA    NA       2          FALSE      
##  3:     maxcompete ParamInt     0   Inf     Inf              4      
##  4:       maxdepth ParamInt     1    30      30             30      
##  5:   maxsurrogate ParamInt     0   Inf     Inf              5      
##  6:      minbucket ParamInt     1   Inf     Inf &lt;NoDefault[3]&gt;      
##  7:       minsplit ParamInt     1   Inf     Inf             20      
##  8: surrogatestyle ParamInt     0     1       2              0      
##  9:   usesurrogate ParamInt     0     2       3              2      
## 10:           xval ParamInt     0   Inf     Inf             10     0</code></pre>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glrn</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_learner.html">as_learner</a></span><span class="op">(</span><span class="va">gr</span> <span class="op">%&gt;&gt;%</span> <span class="va">op_rpart</span><span class="op">)</span>
<span class="va">glrn</span><span class="op">$</span><span class="va">param_set</span></code></pre></div>
<pre><code>## &lt;ParamSetCollection&gt;
##                               id    class lower upper nlevels        default
##  1:                   pca.center ParamLgl    NA    NA       2           TRUE
##  2:                   pca.scale. ParamLgl    NA    NA       2          FALSE
##  3:                    pca.rank. ParamInt     1   Inf     Inf               
##  4:           pca.affect_columns ParamUty    NA    NA     Inf  &lt;Selector[1]&gt;
##  5:                 scale.center ParamLgl    NA    NA       2           TRUE
##  6:                  scale.scale ParamLgl    NA    NA       2           TRUE
##  7:                 scale.robust ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;
##  8:         scale.affect_columns ParamUty    NA    NA     Inf  &lt;Selector[1]&gt;
##  9:             classif.rpart.cp ParamDbl     0     1     Inf           0.01
## 10:     classif.rpart.keep_model ParamLgl    NA    NA       2          FALSE
## 11:     classif.rpart.maxcompete ParamInt     0   Inf     Inf              4
## 12:       classif.rpart.maxdepth ParamInt     1    30      30             30
## 13:   classif.rpart.maxsurrogate ParamInt     0   Inf     Inf              5
## 14:      classif.rpart.minbucket ParamInt     1   Inf     Inf &lt;NoDefault[3]&gt;
## 15:       classif.rpart.minsplit ParamInt     1   Inf     Inf             20
## 16: classif.rpart.surrogatestyle ParamInt     0     1       2              0
## 17:   classif.rpart.usesurrogate ParamInt     0     2       3              2
## 18:           classif.rpart.xval ParamInt     0   Inf     Inf             10
##     value
##  1:  TRUE
##  2:      
##  3:      
##  4:      
##  5:      
##  6:      
##  7: FALSE
##  8:      
##  9:      
## 10:      
## 11:      
## 12:      
## 13:      
## 14:      
## 15:      
## 16:      
## 17:      
## 18:     0</code></pre>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="optimization.html"><span class="header-section-number">4</span> Model Optimization</a></div>
<div class="next"><a href="technical.html"><span class="header-section-number">6</span> Technical</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#pipelines"><span class="header-section-number">5</span> Pipelines</a></li>
<li><a class="nav-link" href="#pipe-pipeops"><span class="header-section-number">5.1</span> The Building Blocks: PipeOps</a></li>
<li><a class="nav-link" href="#pipe-operator"><span class="header-section-number">5.2</span> The Pipeline Operator: %&gt;&gt;%</a></li>
<li><a class="nav-link" href="#pipe-nodes-edges-graphs"><span class="header-section-number">5.3</span> Nodes, Edges and Graphs</a></li>
<li>
<a class="nav-link" href="#pipe-modeling"><span class="header-section-number">5.4</span> Modeling</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pipe-hyperpars"><span class="header-section-number">5.4.1</span> Setting Hyperparameters</a></li>
<li><a class="nav-link" href="#pipe-tuning"><span class="header-section-number">5.4.2</span> Tuning</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#pipe-nonlinear"><span class="header-section-number">5.5</span> Non-Linear Graphs</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pipe-model-ensembles-branching-copying"><span class="header-section-number">5.5.1</span> Branching &amp; Copying</a></li>
<li><a class="nav-link" href="#pipe-model-ensembles"><span class="header-section-number">5.5.2</span> Model Ensembles</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#pipe-special-ops"><span class="header-section-number">5.6</span> Special Operators</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#imputation-pipeopimpute"><span class="header-section-number">5.6.1</span> Imputation: PipeOpImpute</a></li>
<li><a class="nav-link" href="#feature-engineering-pipeopmutate"><span class="header-section-number">5.6.2</span> Feature Engineering: PipeOpMutate</a></li>
<li><a class="nav-link" href="#training-on-data-subsets-pipeopchunk"><span class="header-section-number">5.6.3</span> Training on data subsets: PipeOpChunk</a></li>
<li><a class="nav-link" href="#feature-selection-pipeopfilter-and-pipeopselect"><span class="header-section-number">5.6.4</span> Feature Selection: PipeOpFilter and PipeOpSelect</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#in-depth-pipelines"><span class="header-section-number">5.7</span> In-depth look into mlr3pipelines</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#whats-the-point"><span class="header-section-number">5.7.1</span> What’s the Point</a></li>
<li><a class="nav-link" href="#pipeop-pipeline-operators"><span class="header-section-number">5.7.2</span> PipeOp: Pipeline Operators</a></li>
<li><a class="nav-link" href="#pipeop-channels"><span class="header-section-number">5.7.3</span> PipeOp Channels</a></li>
<li><a class="nav-link" href="#graph-networks-of-pipeops"><span class="header-section-number">5.7.4</span> Graph: Networks of PipeOps</a></li>
<li><a class="nav-link" href="#learners-in-graphs-graphs-in-learners"><span class="header-section-number">5.7.5</span> Learners in Graphs, Graphs in Learners</a></li>
<li><a class="nav-link" href="#hyperparameters"><span class="header-section-number">5.7.6</span> Hyperparameters</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mlr-org/mlr3book/blob/main/bookdown/05-pipelines.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mlr-org/mlr3book/edit/main/bookdown/05-pipelines.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>mlr3 book</strong>" was written by Marc Becker, Martin Binder, Bernd Bischl, Lars Kotthoff, Michel Lang, Florian Pfisterer, Nicholas G. Reich, Jakob Richter, Patrick Schratz, Raphael Sonabend, Damir Pulatov. It was last built on 2021-10-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
