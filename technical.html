<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6 Technical | mlr3 book</title>
<meta name="author" content="Marc Becker">
<meta name="author" content="Martin Binder">
<meta name="author" content="Bernd Bischl">
<meta name="author" content="Lars Kotthoff">
<meta name="author" content="Michel Lang">
<meta name="author" content="Florian Pfisterer">
<meta name="author" content="Nicholas G. Reich">
<meta name="author" content="Jakob Richter">
<meta name="author" content="Patrick Schratz">
<meta name="author" content="Raphael Sonabend">
<meta name="author" content="Damir Pulatov">
<meta name="description" content="This chapter provides an overview of technical details of the mlr3 framework. Parallelization At first, some details about Parallelization and the usage of the future are given. Parallelization...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="6 Technical | mlr3 book">
<meta property="og:type" content="book">
<meta property="og:url" content="https://mlr3book.mlr-org.com/technical.html">
<meta property="og:image" content="https://mlr3book.mlr-org.com//block.png">
<meta property="og:description" content="This chapter provides an overview of technical details of the mlr3 framework. Parallelization At first, some details about Parallelization and the usage of the future are given. Parallelization...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="6 Technical | mlr3 book">
<meta name="twitter:description" content="This chapter provides an overview of technical details of the mlr3 framework. Parallelization At first, some details about Parallelization and the usage of the future are given. Parallelization...">
<meta name="twitter:image" content="https://mlr3book.mlr-org.com//block.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">mlr3 book</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Quickstart</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction and Overview</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">2</span> Basics</a></li>
<li><a class="" href="perf-eval-cmp.html"><span class="header-section-number">3</span> Performance Evaluation and Comparison</a></li>
<li><a class="" href="optimization.html"><span class="header-section-number">4</span> Model Optimization</a></li>
<li><a class="" href="pipelines.html"><span class="header-section-number">5</span> Pipelines</a></li>
<li><a class="active" href="technical.html"><span class="header-section-number">6</span> Technical</a></li>
<li><a class="" href="extending.html"><span class="header-section-number">7</span> Extending</a></li>
<li><a class="" href="special-tasks.html"><span class="header-section-number">8</span> Special Tasks</a></li>
<li><a class="" href="interpretation.html"><span class="header-section-number">9</span> Model Interpretation</a></li>
<li><a class="" href="appendix.html"><span class="header-section-number">10</span> Appendix</a></li>
<li><a class="" href="citation-info.html">Citation Info</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mlr-org/mlr3book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="technical" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Technical<a class="anchor" aria-label="anchor" href="#technical"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter provides an overview of technical details of the <a href="https://mlr3.mlr-org.com">mlr3</a> framework.</p>
<p><strong>Parallelization</strong></p>
<p>At first, some details about <a href="technical.html#parallelization">Parallelization</a> and the usage of the <a href="https://cran.r-project.org/package=future">future</a> are given.
Parallelization refers to the process of running multiple jobs simultaneously.
This process is employed to minimize the necessary computing power.
Algorithms consist of both sequential (non-parallelizable) and parallelizable parts.
Therefore, parallelization does not always alter performance in a positive substantial manner.
Summed up, this sub-chapter illustrates how and when to use parallelization in mlr3.</p>
<p><strong>Database Backends</strong></p>
<p>The section <a href="technical.html#backends">Database Backends</a> describes how to work with database backends that <a href="https://mlr3.mlr-org.com">mlr3</a> supports.
Database backends can be helpful for large data processing which does not fit in memory or is stored natively in a database (e.g. SQLite).
Specifically when working with large data sets, or when undertaking numerous tasks simultaneously, it can be advantageous to interface out-of-memory data.
The section provides an illustration of how to implement <a href="technical.html#backends">Database Backends</a> using of NYC flight data.</p>
<p><strong>Parameters</strong></p>
<p>In the section <a href="technical.html#paradox">Parameters</a> instructions are given on how to:</p>
<ul>
<li>define parameter sets for learners</li>
<li>undertake parameter sampling</li>
<li>apply parameter transformations</li>
</ul>
<p>For illustrative purposes, this sub-chapter uses the <a href="https://paradox.mlr-org.com">paradox</a> package, the successor of <a href="https://cran.r-project.org/package=ParamHelpers">ParamHelpers</a>.</p>
<p><strong>Logging and Verbosity</strong></p>
<p>The sub-chapter on <a href="technical.html#logging">Logging and Verbosity</a> shows how to change the most important settings related to logging.
In <a href="https://mlr3.mlr-org.com">mlr3</a> we use the <a href="https://cran.r-project.org/package=lgr">lgr</a> package.</p>

<div id="parallelization" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Parallelization<a class="anchor" aria-label="anchor" href="#parallelization"><i class="fas fa-link"></i></a>
</h2>
<p>Parallelization refers to the process of running multiple jobs in parallel, simultaneously.
This process allows for significant savings in computing power.
We distinguish between implicit parallelism and explicit parallelism.</p>
<div id="implicit-parallelization" class="section level3" number="6.1.1">
<h3>
<span class="header-section-number">6.1.1</span> Implicit Parallelization<a class="anchor" aria-label="anchor" href="#implicit-parallelization"><i class="fas fa-link"></i></a>
</h3>
<p>We talk about implicit parallelization in this context if we call external code (i.e., code from foreign CRAN packages) which runs in parallel.
Many machine learning algorithms can parallelize their model fit using threading, e.g. <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.ranger.html"><code>ranger</code></a>
or <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.xgboost.html"><code>xgboost</code></a>.
Unfortunately, threading conflicts with certain parallel backends used during explicit parallelization, causing the system to be overutilized in the best case and causing hangs or segfaults in the worst case.
For this reason, we introduced the convention that implicit parallelization is turned off in the defaults, but can be enabled again via a hyperparameter which is tagged with the label <code>"threads"</code>.</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://mlr3verse.mlr-org.com">"mlr3verse"</a></span><span class="op">)</span>

<span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">ids</span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"threads"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "num.threads"</code></pre>
<p>To enable the parallelization for this learner, we simply can call the helper function <a href="https://mlr3.mlr-org.com/reference/set_threads.html"><code>set_threads()</code></a>):</p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set to use 4 CPUs</span>
<span class="fu"><a href="https://mlr3.mlr-org.com/reference/set_threads.html">set_threads</a></span><span class="op">(</span><span class="va">learner</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;LearnerClassifRanger:classif.ranger&gt;
## * Model: -
## * Parameters: num.threads=4
## * Packages: mlr3, mlr3learners, ranger
## * Predict Type: response
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: hotstart_backward, importance, multiclass, oob_error,
##   twoclass, weights</code></pre>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># auto-detect cores on the local machine</span>
<span class="fu"><a href="https://mlr3.mlr-org.com/reference/set_threads.html">set_threads</a></span><span class="op">(</span><span class="va">learner</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;LearnerClassifRanger:classif.ranger&gt;
## * Model: -
## * Parameters: num.threads=2
## * Packages: mlr3, mlr3learners, ranger
## * Predict Type: response
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: hotstart_backward, importance, multiclass, oob_error,
##   twoclass, weights</code></pre>
<p>This also works for filters from <a href="https://mlr3filters.mlr-org.com">mlr3filters</a> and lists of objects, even if some objects do not support threading at all:</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># retrieve 2 filters</span>
<span class="co"># * variance filter with no support for threading</span>
<span class="co"># * mrmr filter with threading support</span>
<span class="va">filters</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3filters.mlr-org.com/reference/flt.html">flts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"variance"</span>, <span class="st">"mrmr"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># set threads for all filters which support it</span>
<span class="fu"><a href="https://mlr3.mlr-org.com/reference/set_threads.html">set_threads</a></span><span class="op">(</span><span class="va">filters</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## &lt;FilterVariance:variance&gt;
## Task Types: classif, regr
## Task Properties: -
## Packages: stats
## Feature types: integer, numeric
## 
## [[2]]
## &lt;FilterMRMR:mrmr&gt;
## Task Types: classif, regr
## Task Properties: -
## Packages: praznik
## Feature types: integer, numeric, factor, ordered</code></pre>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># variance filter is unchanged</span>
<span class="va">filters</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">param_set</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##       id    class lower upper nlevels default value
## 1: na.rm ParamLgl    NA    NA       2    TRUE</code></pre>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># mrmr now works in parallel with 4 cores</span>
<span class="va">filters</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">param_set</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##         id    class lower upper nlevels default value
## 1: threads ParamInt     0   Inf     Inf       0     4</code></pre>
</div>
<div id="explicit-parallelization" class="section level3" number="6.1.2">
<h3>
<span class="header-section-number">6.1.2</span> Explicit Parallelization<a class="anchor" aria-label="anchor" href="#explicit-parallelization"><i class="fas fa-link"></i></a>
</h3>
<p>We talk about explicit parallelization here if <a href="https://mlr3.mlr-org.com">mlr3</a> starts the parallelization itself.
The abstraction implemented in <a href="https://cran.r-project.org/package=future">future</a> is used to support a broad range of parallel backends.
There are two use cases where mlr3 calls future: <a href="https://mlr3.mlr-org.com/reference/resample.html"><code>resample()</code></a> and <a href="https://mlr3.mlr-org.com/reference/benchmark.html"><code>benchmark()</code></a>.
During resampling, all resampling iterations can be executed in parallelization.
The same holds for benchmarking, where additionally all combinations in the provided design are also independent.
These loops are performed by <a href="https://cran.r-project.org/package=future">future</a> using the parallel backend configured with <a href="https://www.rdocumentation.org/packages/future/topics/plan"><code>future::plan()</code></a>.
Extension packages like <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a> internally call <code><a href="https://mlr3.mlr-org.com/reference/benchmark.html">benchmark()</a></code> during tuning and thus work in parallel, too.</p>
<p>In this section, we will use the <a href="https://mlr3.mlr-org.com/reference/mlr_tasks_spam.html"><code>spam task</code></a> and a simple <a href="https://mlr3.mlr-org.com/reference/mlr_learners_classif.rpart.html"><code>classification tree</code></a> to showcase the explicit parallelization.
In this example, the <a href="https://www.rdocumentation.org/packages/future/topics/multisession"><code>future::multisession</code></a> parallel backend is selected which should work on all systems.</p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select the multisession backend</span>
<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="st">"multisession"</span><span class="op">)</span>

<span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"spam"</span><span class="op">)</span>
<span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span>
<span class="va">resampling</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"subsampling"</span><span class="op">)</span>

<span class="va">time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">resampling</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">time</span></code></pre></div>
<p>By default, all CPUs of your machine are used unless you specify argument <code>workers</code> in <a href="https://www.rdocumentation.org/packages/future/topics/plan"><code>future::plan()</code></a>.</p>
<p>On most systems you should see a decrease in the reported elapsed time, but in practice you cannot expect the runtime to fall linearly as the number of cores increases (<a href="https://www.wikiwand.com/en/Amdahl%27s_law">Amdahl’s law</a>).
Depending on the parallel backend, the technical overhead for starting workers, communicating objects, sending back results and shutting down the workers can be quite large.
Therefore, it is advised to only enable parallelization for resamplings where each iteration runs at least some seconds.</p>
<p>If you are transitioning from <a href="https://cran.r-project.org/package=mlr">mlr</a>, you might be used to selecting different parallelization levels, e.g. for resampling, benchmarking or tuning.
In <a href="https://mlr3.mlr-org.com">mlr3</a> this is no longer required (except for nested resampling, briefly described in the following section).
All kind of events are rolled out on the same level.
Therefore, there is no need to decide whether you want to parallelize the tuning OR the resampling.</p>
<p>Just lean back and let the machine do the work :-)</p>
</div>
<div id="nested-resampling-parallelization" class="section level3" number="6.1.3">
<h3>
<span class="header-section-number">6.1.3</span> Nested Resampling Parallelization<a class="anchor" aria-label="anchor" href="#nested-resampling-parallelization"><i class="fas fa-link"></i></a>
</h3>
<p><a href="optimization.html#nested-resampling">Nested resampling</a> results in two nested resampling loops.
We can choose different parallelization backends for the inner and outer resampling loop, respectively.
We just have to pass a list of <a href="https://cran.r-project.org/package=future">future</a> backends:</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Runs the outer loop in parallel and the inner loop sequentially</span>
<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"multisession"</span>, <span class="st">"sequential"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Runs the outer loop sequentially and the inner loop in parallel</span>
<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"sequential"</span>, <span class="st">"multisession"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>While nesting real parallelization backends is often unintended and causes unnecessary overhead, it is useful in some distributed computing setups.
It can be achieved with <a href="https://cran.r-project.org/package=future">future</a> by forcing a fixed number of workers for each loop:</p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Runs both loops in parallel</span>
<span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/tweak.html">tweak</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
  <span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/tweak.html">tweak</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This example would run on 8 cores (<code>= 2 * 4</code>) on the local machine.
The <a href="https://cran.r-project.org/web/packages/future/vignettes/future-3-topologies.html">vignette</a> of the <a href="https://cran.r-project.org/package=future">future</a> package gives more insight into nested parallelization.</p>

</div>
</div>
<div id="error-handling" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"><i class="fas fa-link"></i></a>
</h2>
<p>To demonstrate how to properly deal with misbehaving learners, <a href="https://mlr3.mlr-org.com">mlr3</a> ships with the learner <a href="https://mlr3.mlr-org.com/reference/mlr_learners_classif.debug.html"><code>classif.debug</code></a>:</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.debug"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">learner</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;LearnerClassifDebug:classif.debug&gt;
## * Model: -
## * Parameters: list()
## * Packages: mlr3
## * Predict Type: response
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: hotstart_forward, missings, multiclass, twoclass</code></pre>
<p>This learner comes with special hyperparameters that let us control</p>
<ol style="list-style-type: decimal">
<li>what conditions should be signaled (message, warning, error, segfault) with what probability</li>
<li>during which stage the conditions should be signaled (train or predict)</li>
<li>the ratio of predictions being <code>NA</code> (<code>predict_missing</code>)</li>
</ol>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="va">param_set</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##                       id    class lower upper nlevels        default value
##  1:        error_predict ParamDbl     0     1     Inf              0      
##  2:          error_train ParamDbl     0     1     Inf              0      
##  3:      message_predict ParamDbl     0     1     Inf              0      
##  4:        message_train ParamDbl     0     1     Inf              0      
##  5:      predict_missing ParamDbl     0     1     Inf              0      
##  6: predict_missing_type ParamFct    NA    NA       2             na      
##  7:           save_tasks ParamLgl    NA    NA       2          FALSE      
##  8:     segfault_predict ParamDbl     0     1     Inf              0      
##  9:       segfault_train ParamDbl     0     1     Inf              0      
## 10:          sleep_train ParamUty    NA    NA     Inf &lt;NoDefault[3]&gt;      
## 11:        sleep_predict ParamUty    NA    NA     Inf &lt;NoDefault[3]&gt;      
## 12:              threads ParamInt     1   Inf     Inf &lt;NoDefault[3]&gt;      
## 13:      warning_predict ParamDbl     0     1     Inf              0      
## 14:        warning_train ParamDbl     0     1     Inf              0      
## 15:                    x ParamDbl     0     1     Inf &lt;NoDefault[3]&gt;      
## 16:                 iter ParamInt     1   Inf     Inf              1</code></pre>
<p>With the learner’s default settings, the learner will do nothing special: The learner learns a random label and creates constant predictions.</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">$</span><span class="va">confusion</span></code></pre></div>
<pre><code>##             truth
## response     setosa versicolor virginica
##   setosa          0          0         0
##   versicolor     50         50        50
##   virginica       0          0         0</code></pre>
<p>We now set a hyperparameter to let the debug learner signal an error during the train step.
By default,<a href="https://github.com/mlr-org/mlr3">mlr3</a> does not catch conditions such as warnings or errors raised by third-party code like learners:</p>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>error_train <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in .__LearnerClassifDebug__.train(self = self, private = private, : Error from classif.debug-&gt;train()</code></pre>
<p>If this would be a regular learner, we could now start debugging with <a href="https://www.rdocumentation.org/packages/base/topics/traceback"><code>traceback()</code></a> (or create a <a href="https://stackoverflow.com/help/minimal-reproducible-example">MRE</a> to file a bug report).</p>
<p>However, machine learning algorithms raising errors is not uncommon as algorithms typically cannot process all possible data.
Thus, we need a mechanism to</p>
<ol style="list-style-type: decimal">
<li>capture all signaled conditions such as messages, warnings and errors so that we can analyze them post-hoc, and</li>
<li>a statistically sound way to proceed the calculation and be able to aggregate over partial results.</li>
</ol>
<p>These two mechanisms are explained in the following subsections.</p>
<div id="encapsulation" class="section level3" number="6.2.1">
<h3>
<span class="header-section-number">6.2.1</span> Encapsulation<a class="anchor" aria-label="anchor" href="#encapsulation"><i class="fas fa-link"></i></a>
</h3>
<p>With encapsulation, exceptions do not stop the program flow and all output is logged to the learner (instead of printed to the console).
Each <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a> has a field <code>encapsulate</code> to control how the train or predict steps are executed.
One way to encapsulate the execution is provided by the package <a href="https://cran.r-project.org/package=evaluate">evaluate</a> (see <a href="https://mlr3misc.mlr-org.com/reference/encapsulate.html"><code>encapsulate()</code></a> for more details):</p>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.debug"</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>warning_train <span class="op">=</span> <span class="fl">1</span>, error_train <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="va">encapsulate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>train <span class="op">=</span> <span class="st">"evaluate"</span>, predict <span class="op">=</span> <span class="st">"evaluate"</span><span class="op">)</span>

<span class="va">learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></code></pre></div>
<p>After training the learner, one can access the recorded log via the fields <code>log</code>, <code>warnings</code> and <code>errors</code>:</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="va">log</span></code></pre></div>
<pre><code>##    stage   class                                 msg
## 1: train warning Warning from classif.debug-&gt;train()
## 2: train   error   Error from classif.debug-&gt;train()</code></pre>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="va">warnings</span></code></pre></div>
<pre><code>## [1] "Warning from classif.debug-&gt;train()"</code></pre>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="va">errors</span></code></pre></div>
<pre><code>## [1] "Error from classif.debug-&gt;train()"</code></pre>
<p>Another method for encapsulation is implemented in the <a href="https://cran.r-project.org/package=callr">callr</a> package.
<a href="https://cran.r-project.org/package=callr">callr</a> spawns a new R process to execute the respective step, and thus even guards the current session from segfaults.
On the downside, starting new processes comes with a computational overhead.</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="va">encapsulate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>train <span class="op">=</span> <span class="st">"callr"</span>, predict <span class="op">=</span> <span class="st">"callr"</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>segfault_train <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span>task <span class="op">=</span> <span class="va">task</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="va">errors</span></code></pre></div>
<pre><code>## [1] "callr process exited with status -11"</code></pre>
<p>Without a model, it is not possible to get predictions though:</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></code></pre></div>
<pre><code>## Error: Cannot predict, Learner 'classif.debug' has not been trained yet</code></pre>
<p>To handle the missing predictions in a graceful way during <a href="https://mlr3.mlr-org.com/reference/resample.html"><code>resample()</code></a> or <a href="https://mlr3.mlr-org.com/reference/benchmark.html"><code>benchmark()</code></a>, fallback learners are introduced next.</p>
</div>
<div id="fallback-learners" class="section level3" number="6.2.2">
<h3>
<span class="header-section-number">6.2.2</span> Fallback learners<a class="anchor" aria-label="anchor" href="#fallback-learners"><i class="fas fa-link"></i></a>
</h3>
<p>Fallback learners have the purpose to allow scoring results in cases where a <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a> is misbehaving in some sense.
Some typical examples include:</p>
<ul>
<li>The learner fails to fit a model during training, e.g., if some convergence criterion is not met or the learner ran out of memory.</li>
<li>The learner fails to predict for some or all observations.
A typical case is e.g. new factor levels in the test data.</li>
</ul>
<p>We first handle the most common case that a learner completely breaks while fitting a model or while predicting on new data.
If the learner fails in either of these two steps, we rely on a second learner to generate predictions: the fallback learner.</p>
<p>In the next example, in addition to the debug learner, we attach a simple featureless learner to the debug learner.
So whenever the debug learner fails (which is every time with the given parametrization) and encapsulation in enabled, <code>mlr3</code> falls back to the predictions of the featureless learner internally:</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.debug"</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>error_train <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="va">encapsulate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>train <span class="op">=</span> <span class="st">"evaluate"</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="va">fallback</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.featureless"</span><span class="op">)</span>
<span class="va">learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span>
<span class="va">learner</span></code></pre></div>
<pre><code>## &lt;LearnerClassifDebug:classif.debug&gt;
## * Model: -
## * Parameters: error_train=1
## * Packages: mlr3
## * Predict Type: response
## * Feature types: logical, integer, numeric, character, factor, ordered
## * Properties: hotstart_forward, missings, multiclass, twoclass
## * Errors: Error from classif.debug-&gt;train()</code></pre>
<p>Note that the log contains the captured error (which is also included in the print output), and although we don’t have a model, we can still get predictions:</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="va">model</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prediction</span> <span class="op">=</span> <span class="va">learner</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span><span class="op">)</span>
<span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## classif.ce 
##     0.6667</code></pre>
<p>While the fallback learner is of limited use for this stepwise train-predict procedure, it is invaluable for larger benchmark studies where only few resampling iterations are failing.
Here, we need to replace the missing scores with a number in order to aggregate over all resampling iterations.
And imputing a number which is equivalent to guessing labels often seems to be the right amount of penalization.</p>
<p>In the following snippet we compare the previously created debug learner with a simple classification tree.
We re-parametrize the debug learner to fail in roughly 30% of the resampling iterations during the training step:</p>
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">learner</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>error_train <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>

<span class="va">bmr</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/benchmark.html">benchmark</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/benchmark_grid.html">benchmark_grid</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">learner</span>, <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">aggr</span> <span class="op">=</span> <span class="va">bmr</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span>conditions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">aggr</span></code></pre></div>
<pre><code>##    nr      resample_result task_id    learner_id resampling_id iters warnings
## 1:  1 &lt;ResampleResult[22]&gt;    iris classif.debug            cv    10        0
## 2:  2 &lt;ResampleResult[22]&gt;    iris classif.rpart            cv    10        0
##    errors classif.ce
## 1:      3    0.71333
## 2:      0    0.07333</code></pre>
<p>To further investigate the errors, we can extract the <a href="https://mlr3.mlr-org.com/reference/ResampleResult.html"><code>ResampleResult</code></a>:</p>
<div class="sourceCode" id="cb498"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rr</span> <span class="op">=</span> <span class="va">aggr</span><span class="op">[</span><span class="va">learner_id</span> <span class="op">==</span> <span class="st">"classif.debug"</span><span class="op">]</span><span class="op">$</span><span class="va">resample_result</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span>
<span class="va">rr</span><span class="op">$</span><span class="va">errors</span></code></pre></div>
<pre><code>##    iteration                               msg
## 1:         2 Error from classif.debug-&gt;train()
## 2:         6 Error from classif.debug-&gt;train()
## 3:         7 Error from classif.debug-&gt;train()</code></pre>
<p>A similar yet different problem emerges when a learner predicts only a subset of the observations in the test set (and predicts <code>NA</code> for others).
Handling such predictions in a statistically sound way is not straight-forward and a common source for over-optimism when reporting results.
Imagine that our goal is to benchmark two algorithms using a 10-fold cross validation on some binary classification task:</p>
<ul>
<li>Algorithm A is a ordinary logistic regression.</li>
<li>Algorithm B is also a ordinary logistic regression, but with a twist:
If the logistic regression is rather certain about the predicted label (&gt; 90% probability), it returns the label and a missing value otherwise.</li>
</ul>
<p>When comparing the performance of these two algorithms, it is obviously not fair to average over all predictions of algorithm A while only average over the “easy-to-predict” observations for algorithm B.
By doing so, algorithm B would easily outperform algorithm A, but you have not factored in that you can not generate predictions for many observations.
On the other hand, it is also not feasible to exclude all observations from the test set of a benchmark study where at least one algorithm failed to predict a label.
Instead, we proceed by imputing all missing predictions with something naive, e.g., by predicting the majority class with a featureless learner.
And as the majority class may depend on the resampling split (or we opt for some other arbitrary baseline learner), it is best to just train a second learner on the same resampling split.</p>
<p>Long story short, if a fallback learner is involved, missing predictions of the base learner will be automatically replaced with predictions from the fallback learner.
This is illustrated in the following example:</p>
<div class="sourceCode" id="cb500"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.debug"</span><span class="op">)</span>

<span class="co"># this hyperparameter sets the ratio of missing predictions</span>
<span class="va">learner</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>predict_missing <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>

<span class="co"># without fallback</span>
<span class="va">p</span> <span class="op">=</span> <span class="va">learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">response</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     setosa versicolor  virginica       &lt;NA&gt; 
##          0          0         75         75</code></pre>
<div class="sourceCode" id="cb502"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># with fallback</span>
<span class="va">learner</span><span class="op">$</span><span class="va">fallback</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.featureless"</span><span class="op">)</span>
<span class="va">p</span> <span class="op">=</span> <span class="va">learner</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task</span><span class="op">)</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">response</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     setosa versicolor  virginica       &lt;NA&gt; 
##          0        150          0          0</code></pre>
<p>Summed up, by combining encapsulation and fallback learners, it is possible to benchmark even quite unreliable or instable learning algorithms in a convenient way.</p>

</div>
</div>
<div id="backends" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Database Backends<a class="anchor" aria-label="anchor" href="#backends"><i class="fas fa-link"></i></a>
</h2>
<p>In mlr3, <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a>s store their data in an abstract data format, the <a href="https://mlr3.mlr-org.com/reference/DataBackend.html"><code>DataBackend</code></a>.
The default backend uses <a href="https://cran.r-project.org/package=data.table">data.table</a> via the <a href="https://mlr3.mlr-org.com/reference/DataBackendDataTable.html"><code>DataBackendDataTable</code></a> as an in-memory data base.</p>
<p>For larger data, or when working with many tasks in parallel, it can be advantageous to interface an out-of-memory data.
We use the excellent R package <a href="https://cran.r-project.org/package=dbplyr">dbplyr</a> which extends <a href="https://cran.r-project.org/package=dplyr">dplyr</a> to work on many popular data bases like <a href="https://mariadb.org/">MariaDB</a>, <a href="https://www.postgresql.org/">PostgreSQL</a> or <a href="https://www.sqlite.org">SQLite</a>.</p>
<div id="use-case-nyc-flights" class="section level3" number="6.3.1">
<h3>
<span class="header-section-number">6.3.1</span> Use Case: NYC Flights<a class="anchor" aria-label="anchor" href="#use-case-nyc-flights"><i class="fas fa-link"></i></a>
</h3>
<p>To generate a halfway realistic scenario, we use the NYC flights data set from package <a href="https://cran.r-project.org/package=nycflights13">nycflights13</a>:</p>
<div class="sourceCode" id="cb504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load data</span>
<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"DBI"</span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required namespace: DBI</code></pre>
<div class="sourceCode" id="cb506"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"RSQLite"</span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required namespace: RSQLite</code></pre>
<div class="sourceCode" id="cb508"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"nycflights13"</span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required namespace: nycflights13</code></pre>
<div class="sourceCode" id="cb510"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"flights"</span>, package <span class="op">=</span> <span class="st">"nycflights13"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></code></pre></div>
<pre><code>## tibble [336,776 × 19] (S3: tbl_df/tbl/data.frame)
##  $ year          : int [1:336776] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ month         : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
##  $ day           : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
##  $ dep_time      : int [1:336776] 517 533 542 544 554 554 555 557 557 558 ...
##  $ sched_dep_time: int [1:336776] 515 529 540 545 600 558 600 600 600 600 ...
##  $ dep_delay     : num [1:336776] 2 4 2 -1 -6 -4 -5 -3 -3 -2 ...
##  $ arr_time      : int [1:336776] 830 850 923 1004 812 740 913 709 838 753 ...
##  $ sched_arr_time: int [1:336776] 819 830 850 1022 837 728 854 723 846 745 ...
##  $ arr_delay     : num [1:336776] 11 20 33 -18 -25 12 19 -14 -8 8 ...
##  $ carrier       : chr [1:336776] "UA" "UA" "AA" "B6" ...
##  $ flight        : int [1:336776] 1545 1714 1141 725 461 1696 507 5708 79 301 ...
##  $ tailnum       : chr [1:336776] "N14228" "N24211" "N619AA" "N804JB" ...
##  $ origin        : chr [1:336776] "EWR" "LGA" "JFK" "JFK" ...
##  $ dest          : chr [1:336776] "IAH" "IAH" "MIA" "BQN" ...
##  $ air_time      : num [1:336776] 227 227 160 183 116 150 158 53 140 138 ...
##  $ distance      : num [1:336776] 1400 1416 1089 1576 762 ...
##  $ hour          : num [1:336776] 5 5 5 5 6 5 6 6 6 6 ...
##  $ minute        : num [1:336776] 15 29 40 45 0 58 0 0 0 0 ...
##  $ time_hour     : POSIXct[1:336776], format: "2013-01-01 05:00:00" "2013-01-01 05:00:00" ...</code></pre>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add column of unique row ids</span>
<span class="va">flights</span><span class="op">$</span><span class="va">row_id</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span>

<span class="co"># create sqlite database in temporary file</span>
<span class="va">path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="st">"flights"</span>, fileext <span class="op">=</span> <span class="st">".sqlite"</span><span class="op">)</span>
<span class="va">con</span> <span class="op">=</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">path</span><span class="op">)</span>
<span class="va">tbl</span> <span class="op">=</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html">dbWriteTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"flights"</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span><span class="op">)</span>
<span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span>

<span class="co"># remove in-memory data</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></code></pre></div>
</div>
<div id="preprocessing-with-dplyr" class="section level3" number="6.3.2">
<h3>
<span class="header-section-number">6.3.2</span> Preprocessing with <code>dplyr</code><a class="anchor" aria-label="anchor" href="#preprocessing-with-dplyr"><i class="fas fa-link"></i></a>
</h3>
<p>With the SQLite database in <code>path</code>, we now re-establish a connection and switch to <a href="https://cran.r-project.org/package=dplyr">dplyr</a>/<a href="https://cran.r-project.org/package=dbplyr">dbplyr</a> for some essential preprocessing.</p>
<div class="sourceCode" id="cb513"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># establish connection</span>
<span class="va">con</span> <span class="op">=</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">path</span><span class="op">)</span>

<span class="co"># select the "flights" table, enter dplyr</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb517"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dbplyr.tidyverse.org/">"dbplyr"</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dbplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:dplyr':
## 
##     ident, sql</code></pre>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tbl</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"flights"</span><span class="op">)</span></code></pre></div>
<p>First, we select a subset of columns to work on:</p>
<div class="sourceCode" id="cb521"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">keep</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"row_id"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"hour"</span>, <span class="st">"minute"</span>, <span class="st">"dep_time"</span>,
  <span class="st">"arr_time"</span>, <span class="st">"carrier"</span>, <span class="st">"flight"</span>, <span class="st">"air_time"</span>, <span class="st">"distance"</span>, <span class="st">"arr_delay"</span><span class="op">)</span>
<span class="va">tbl</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">keep</span><span class="op">)</span></code></pre></div>
<p>Additionally, we remove those observations where the arrival delay (<code>arr_delay</code>) has a missing value:</p>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tbl</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To keep runtime reasonable for this toy example, we filter the data to only use every second row:</p>
<div class="sourceCode" id="cb523"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tbl</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">row_id</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>The factor levels of the feature <code>carrier</code> are merged so that infrequent carriers are replaced by level “other”:</p>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tbl</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">tbl</span>, carrier <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
  <span class="va">carrier</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"OO"</span>, <span class="st">"HA"</span>, <span class="st">"YV"</span>, <span class="st">"F9"</span>, <span class="st">"AS"</span>, <span class="st">"FL"</span>, <span class="st">"VX"</span>, <span class="st">"WN"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"other"</span>,
  <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">carrier</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="databackenddplyr" class="section level3" number="6.3.3">
<h3>
<span class="header-section-number">6.3.3</span> DataBackendDplyr<a class="anchor" aria-label="anchor" href="#databackenddplyr"><i class="fas fa-link"></i></a>
</h3>
<p>The processed table is now used to create a <a href="https://mlr3db.mlr-org.com/reference/DataBackendDplyr.html"><code>mlr3db::DataBackendDplyr</code></a> from <a href="https://mlr3db.mlr-org.com">mlr3db</a>:</p>
<div class="sourceCode" id="cb525"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https:///mlr3db.mlr-org.com">"mlr3db"</a></span><span class="op">)</span>
<span class="va">b</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_data_backend.html">as_data_backend</a></span><span class="op">(</span><span class="va">tbl</span>, primary_key <span class="op">=</span> <span class="st">"row_id"</span><span class="op">)</span></code></pre></div>
<p>We can now use the interface of <a href="https://mlr3.mlr-org.com/reference/DataBackend.html"><code>DataBackend</code></a> to query some basic information of the data:</p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span><span class="op">$</span><span class="va">nrow</span></code></pre></div>
<pre><code>## [1] 163707</code></pre>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span><span class="op">$</span><span class="va">ncol</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode" id="cb530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##    row_id year month day hour minute dep_time arr_time carrier flight air_time
## 1:      2 2013     1   1    5     29      533      850      UA   1714      227
## 2:      4 2013     1   1    5     45      544     1004      B6    725      183
## 3:      6 2013     1   1    5     58      554      740      UA   1696      150
## 4:      8 2013     1   1    6      0      557      709      EV   5708       53
## 5:     10 2013     1   1    6      0      558      753      AA    301      138
## 6:     12 2013     1   1    6      0      558      853      B6     71      158
##    distance arr_delay
## 1:     1416        20
## 2:     1576       -18
## 3:      719        12
## 4:      229       -14
## 5:      733         8
## 6:     1005        -3</code></pre>
<p>Note that the <a href="https://mlr3db.mlr-org.com/reference/DataBackendDplyr.html"><code>DataBackendDplyr</code></a> does not know about any rows or columns we have filtered out with <a href="https://cran.r-project.org/package=dplyr">dplyr</a> before, it just operates on the view we provided.</p>
</div>
<div id="model-fitting" class="section level3" number="6.3.4">
<h3>
<span class="header-section-number">6.3.4</span> Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"><i class="fas fa-link"></i></a>
</h3>
<p>We create the following <a href="https://mlr3.mlr-org.com">mlr3</a> objects:</p>
<ul>
<li>A <a href="https://mlr3.mlr-org.com/reference/TaskRegr.html"><code>regression task</code></a>, based on the previously created <a href="https://mlr3db.mlr-org.com/reference/DataBackendDplyr.html"><code>mlr3db::DataBackendDplyr</code></a>.</li>
<li>A regression learner (<a href="https://mlr3.mlr-org.com/reference/mlr_learners_regr.rpart.html"><code>regr.rpart</code></a>).</li>
<li>A resampling strategy: 3 times repeated subsampling using 2% of the observations for training (“<a href="https://mlr3.mlr-org.com/reference/mlr_resamplings_subsampling.html"><code>subsampling</code></a>”)</li>
<li>Measures “<a href="https://mlr3.mlr-org.com/reference/mlr_measures_regr.mse.html"><code>mse</code></a>”, “<a href="https://mlr3.mlr-org.com/reference/mlr_measures_elapsed_time.html"><code>time_train</code></a>” and “<a href="https://mlr3.mlr-org.com/reference/mlr_measures_elapsed_time.html"><code>time_predict</code></a>”</li>
</ul>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_regr.html">as_task_regr</a></span><span class="op">(</span><span class="va">b</span>, id <span class="op">=</span> <span class="st">"flights_sqlite"</span>, target <span class="op">=</span> <span class="st">"arr_delay"</span><span class="op">)</span>
<span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.rpart"</span><span class="op">)</span>
<span class="va">measures</span> <span class="op">=</span> <span class="va">mlr_measures</span><span class="op">$</span><span class="fu">mget</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"regr.mse"</span>, <span class="st">"time_train"</span>, <span class="st">"time_predict"</span><span class="op">)</span><span class="op">)</span>
<span class="va">resampling</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span><span class="op">(</span><span class="st">"subsampling"</span><span class="op">)</span>
<span class="va">resampling</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>repeats <span class="op">=</span> <span class="fl">3</span>, ratio <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></code></pre></div>
<p>We pass all these objects to <a href="https://mlr3.mlr-org.com/reference/resample.html"><code>resample()</code></a> to perform a simple resampling with three iterations.
In each iteration, only the required subset of the data is queried from the SQLite data base and passed to <a href="https://www.rdocumentation.org/packages/rpart/topics/rpart"><code>rpart::rpart()</code></a>:</p>
<div class="sourceCode" id="cb533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rr</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/resample.html">resample</a></span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">resampling</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">rr</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ResampleResult&gt; of 3 iterations
## * Task: flights_sqlite
## * Learner: regr.rpart
## * Warnings: 0 in 0 iterations
## * Errors: 0 in 0 iterations</code></pre>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rr</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span><span class="va">measures</span><span class="op">)</span></code></pre></div>
<pre><code>##     regr.mse   time_train time_predict 
##         1187            0            0</code></pre>
</div>
<div id="cleanup" class="section level3" number="6.3.5">
<h3>
<span class="header-section-number">6.3.5</span> Cleanup<a class="anchor" aria-label="anchor" href="#cleanup"><i class="fas fa-link"></i></a>
</h3>
<p>Finally, we remove the <code>tbl</code> object and close the connection.</p>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span>
<span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></code></pre></div>

</div>
</div>
<div id="paradox" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Parameters (using <code>paradox</code>)<a class="anchor" aria-label="anchor" href="#paradox"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://paradox.mlr-org.com">paradox</a> package offers a language for the description of <em>parameter spaces</em>, as well as tools for useful operations on these parameter spaces.
A parameter space is often useful when describing:</p>
<ul>
<li>A set of sensible input values for an R function</li>
<li>The set of possible values that slots of a configuration object can take</li>
<li>The search space of an optimization process</li>
</ul>
<p>The tools provided by <code>paradox</code> therefore relate to:</p>
<ul>
<li>
<strong>Parameter checking</strong>: Verifying that a set of parameters satisfies the conditions of a parameter space</li>
<li>
<strong>Parameter sampling</strong>: Generating parameter values that lie in the parameter space for systematic exploration of program behavior depending on these parameters</li>
</ul>
<p><a href="https://paradox.mlr-org.com">paradox</a> is, by nature, an auxiliary package that derives its usefulness from other packages that make use of it.
It is heavily utilized in other <a href="https://github.com/mlr-org">mlr-org</a> packages such as <a href="https://mlr3.mlr-org.com">mlr3</a>, <a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a>, and <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a>.</p>
<div id="reference-based-objects" class="section level3" number="6.4.1">
<h3>
<span class="header-section-number">6.4.1</span> Reference Based Objects<a class="anchor" aria-label="anchor" href="#reference-based-objects"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://paradox.mlr-org.com">paradox</a> is the spiritual successor to the <a href="https://cran.r-project.org/package=ParamHelpers">ParamHelpers</a> package and was written from scratch using the <a href="https://cran.r-project.org/package=R6">R6</a> class system.
The most important consequence of this is that all objects created in <code>paradox</code> are “reference-based”, unlike most other objects in R.
When a change is made to a <code>ParamSet</code> object, for example by adding a parameter using the <code>$add()</code> function, all variables that point to this <code>ParamSet</code> will contain the changed object.
To create an independent copy of a <code>ParamSet</code>, the <code>$clone()</code> method needs to be used:</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://paradox.mlr-org.com">"paradox"</a></span><span class="op">)</span>

<span class="va">ps</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">ps2</span> <span class="op">=</span> <span class="va">ps</span>
<span class="va">ps3</span> <span class="op">=</span> <span class="va">ps</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span> <span class="co"># the same for ps2 and ps3</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
## Empty.</code></pre>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamLgl.html">ParamLgl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>  <span class="co"># ps was changed</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##    id    class lower upper nlevels        default value
## 1:  a ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;</code></pre>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ps2</span><span class="op">)</span> <span class="co"># contains the same reference as ps</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##    id    class lower upper nlevels        default value
## 1:  a ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;</code></pre>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ps3</span><span class="op">)</span> <span class="co"># is a "clone" of the old (empty) ps</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
## Empty.</code></pre>
</div>
<div id="defining-a-parameter-space" class="section level3" number="6.4.2">
<h3>
<span class="header-section-number">6.4.2</span> Defining a Parameter Space<a class="anchor" aria-label="anchor" href="#defining-a-parameter-space"><i class="fas fa-link"></i></a>
</h3>
<div id="single-parameters" class="section level4" number="6.4.2.1">
<h4>
<span class="header-section-number">6.4.2.1</span> Single Parameters<a class="anchor" aria-label="anchor" href="#single-parameters"><i class="fas fa-link"></i></a>
</h4>
<p>The basic building block for describing parameter spaces is the <strong><code>Param</code></strong> class.
It represents a single parameter, which usually can take a single atomic value.
Consider, for example, trying to configure the <code>rpart</code> package’s <code>rpart.control</code> object.
It has various components (<code>minsplit</code>, <code>cp</code>, …) that all take a single value, and that would all be represented by a different instance of a <code>Param</code> object.</p>
<p>The <code>Param</code> class has various sub-classes that represent different value types:</p>
<ul>
<li>
<a href="https://paradox.mlr-org.com/reference/ParamInt.html"><code>ParamInt</code></a>: Integer numbers</li>
<li>
<a href="https://paradox.mlr-org.com/reference/ParamDbl.html"><code>ParamDbl</code></a>: Real numbers</li>
<li>
<a href="https://paradox.mlr-org.com/reference/ParamFct.html"><code>ParamFct</code></a>: String values from a set of possible values, similar to R <code>factor</code>s</li>
<li>
<a href="https://paradox.mlr-org.com/reference/ParamLgl.html"><code>ParamLgl</code></a>: Truth values (<code>TRUE</code> / <code>FALSE</code>), as <code>logical</code>s in R</li>
<li>
<a href="https://paradox.mlr-org.com/reference/ParamUty.html"><code>ParamUty</code></a>: Parameter that can take any value</li>
</ul>
<p>A particular instance of a parameter is created by calling the attached <code>$new()</code> function:</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://paradox.mlr-org.com">"paradox"</a></span><span class="op">)</span>
<span class="va">parA</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamLgl.html">ParamLgl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>
<span class="va">parB</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamInt.html">ParamInt</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"B"</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">10</span>, tags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tag1"</span>, <span class="st">"tag2"</span><span class="op">)</span><span class="op">)</span>
<span class="va">parC</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamDbl.html">ParamDbl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"C"</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">4</span>, special_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>
<span class="va">parD</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamFct.html">ParamFct</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"D"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, default <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span>
<span class="va">parE</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamUty.html">ParamUty</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"E"</span>, custom_check <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">checkmate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/checkmate/man/checkFunction.html">checkFunction</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Every parameter must have:</p>
<ul>
<li>
<strong>id</strong> - A name for the parameter within the parameter set</li>
<li>
<strong>default</strong> - A default value</li>
<li>
<strong>special_vals</strong> - A list of values that are accepted even if they do not conform to the type</li>
<li>
<strong>tags</strong> - Tags that can be used to organize parameters</li>
</ul>
<p>The numeric (<code>Int</code> and <code>Dbl</code>) parameters furthermore allow for specification of a <strong>lower</strong> and <strong>upper</strong> bound.
Meanwhile, the <code>Fct</code> parameter must be given a vector of <strong>levels</strong> that define the possible states its parameter can take.
The <code>Uty</code> parameter can also have a <strong><code>custom_check</code></strong> function that must return <code>TRUE</code> when a value is acceptable and may return a <code>character(1)</code> error description otherwise.
The example above defines <code>parE</code> as a parameter that only accepts functions.</p>
<p>All values which are given to the constructor are then accessible from the object for inspection using <code>$</code>.
Although all these values can be changed for a parameter after construction, this can be a bad idea and should be avoided when possible.</p>
<p>Instead, a new parameter should be constructed.
Besides the possible values that can be given to a constructor, there are also the <code>$class</code>, <code>$nlevels</code>, <code>$is_bounded</code>, <code>$has_default</code>, <code>$storage_type</code>, <code>$is_number</code> and <code>$is_categ</code> slots that give information about a parameter.</p>
<p>A list of all slots can be found in <a href="https://paradox.mlr-org.com/reference/Param.html"><code>?Param</code></a>.</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parB</span><span class="op">$</span><span class="va">lower</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parA</span><span class="op">$</span><span class="va">levels</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parE</span><span class="op">$</span><span class="va">class</span></code></pre></div>
<pre><code>## [1] "ParamUty"</code></pre>
<p>It is also possible to get all information of a <code>Param</code> as <code>data.table</code> by calling <code>as.data.table</code>.</p>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">parA</span><span class="op">)</span></code></pre></div>
<pre><code>##    id    class lower upper      levels nlevels is_bounded special_vals        default storage_type tags
## 1:  A ParamLgl    NA    NA  TRUE,FALSE       2       TRUE    &lt;list[0]&gt; &lt;NoDefault[3]&gt;      logical</code></pre>
<div id="type-range-checking" class="section level5" number="6.4.2.1.1">
<h5>
<span class="header-section-number">6.4.2.1.1</span> Type / Range Checking<a class="anchor" aria-label="anchor" href="#type-range-checking"><i class="fas fa-link"></i></a>
</h5>
<p>A <code>Param</code> object offers the possibility to check whether a value satisfies its condition, i.e. is of the right type, and also falls within the range of allowed values, using the <code>$test()</code>, <code>$check()</code>, and <code>$assert()</code> functions.
<code><a href="https://Rdatatable.gitlab.io/data.table/reference/test.html">test()</a></code> should be used within conditional checks and returns <code>TRUE</code> or <code>FALSE</code>, while <code><a href="https://rdrr.io/r/utils/PkgUtils.html">check()</a></code> returns an error description when a value does not conform to the parameter (and thus plays well with the <a href="https://www.rdocumentation.org/packages/checkmate/topics/assert"><code>checkmate::assert()</code></a> function).
<code>assert()</code> will throw an error whenever a value does not fit.</p>
<div class="sourceCode" id="cb556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parA</span><span class="op">$</span><span class="fu">test</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parA</span><span class="op">$</span><span class="fu">test</span><span class="op">(</span><span class="st">"FALSE"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">parA</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="st">"FALSE"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Must be of type 'logical flag', not 'character'"</code></pre>
<p>Instead of testing single parameters, it is often more convenient to check a whole set of parameters using a <code>ParamSet</code>.</p>
</div>
</div>
<div id="parameter-sets" class="section level4" number="6.4.2.2">
<h4>
<span class="header-section-number">6.4.2.2</span> Parameter Sets<a class="anchor" aria-label="anchor" href="#parameter-sets"><i class="fas fa-link"></i></a>
</h4>
<p>The ordered collection of parameters is handled in a <code>ParamSet</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Although the name is suggestive of a “Set”-valued &lt;code&gt;Param&lt;/code&gt;, this is unrelated to the other objects that follow the &lt;code&gt;ParamXxx&lt;/code&gt; naming scheme.&lt;/p&gt;"><sup>2</sup></a>.
It is initialized using the <code>$new()</code> function and optionally takes a list of <code>Param</code>s as argument.
Parameters can also be added to the constructed <code>ParamSet</code> using the <code>$add()</code> function.
It is even possible to add whole <code>ParamSet</code>s to other <code>ParamSet</code>s.</p>
<div class="sourceCode" id="cb562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">parA</span>, <span class="va">parB</span><span class="op">)</span><span class="op">)</span>
<span class="va">ps</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">parC</span><span class="op">)</span>
<span class="va">ps</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">parD</span>, <span class="va">parE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##    id    class lower upper nlevels        default value
## 1:  A ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;      
## 2:  B ParamInt     0    10      11 &lt;NoDefault[3]&gt;      
## 3:  C ParamDbl     0     4     Inf &lt;NoDefault[3]&gt;      
## 4:  D ParamFct    NA    NA       3              y      
## 5:  E ParamUty    NA    NA     Inf &lt;NoDefault[3]&gt;</code></pre>
<p>The individual parameters can be accessed through the <code>$params</code> slot.
It is also possible to get information about all parameters in a vectorized fashion using mostly the same slots as for individual <code>Param</code>s (i.e. <code>$class</code>, <code>$levels</code> etc.), see <code><a href="https://paradox.mlr-org.com/reference/ParamSet.html">?ParamSet</a></code> for details.</p>
<p>It is possible to reduce <code>ParamSet</code>s using the <strong><code>$subset</code></strong> method.
Be aware that it modifies a ParamSet in-place, so a “clone” must be created first if the original <code>ParamSet</code> should not be modified.</p>
<div class="sourceCode" id="cb564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psSmall</span> <span class="op">=</span> <span class="va">ps</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span>
<span class="va">psSmall</span><span class="op">$</span><span class="fu">subset</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">psSmall</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##    id    class lower upper nlevels        default value
## 1:  A ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;      
## 2:  B ParamInt     0    10      11 &lt;NoDefault[3]&gt;      
## 3:  C ParamDbl     0     4     Inf &lt;NoDefault[3]&gt;</code></pre>
<p>Just as for <code>Param</code>s, and much more useful, it is possible to get the <code>ParamSet</code> as a <code>data.table</code> using <code><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table()</a></code>.
This makes it easy to subset parameters on certain conditions and aggregate information about them, using the variety of methods provided by <code>data.table</code>.</p>
<div class="sourceCode" id="cb566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></code></pre></div>
<pre><code>##    id    class lower upper      levels nlevels is_bounded special_vals        default storage_type      tags
## 1:  A ParamLgl    NA    NA  TRUE,FALSE       2       TRUE    &lt;list[0]&gt; &lt;NoDefault[3]&gt;      logical          
## 2:  B ParamInt     0    10                  11       TRUE    &lt;list[0]&gt; &lt;NoDefault[3]&gt;      integer tag1,tag2
## 3:  C ParamDbl     0     4                 Inf       TRUE    &lt;list[1]&gt; &lt;NoDefault[3]&gt;      numeric          
## 4:  D ParamFct    NA    NA       x,y,z       3       TRUE    &lt;list[0]&gt;              y    character          
## 5:  E ParamUty    NA    NA                 Inf      FALSE    &lt;list[0]&gt; &lt;NoDefault[3]&gt;         list</code></pre>
<div id="type-range-checking-1" class="section level5" number="6.4.2.2.1">
<h5>
<span class="header-section-number">6.4.2.2.1</span> Type / Range Checking<a class="anchor" aria-label="anchor" href="#type-range-checking-1"><i class="fas fa-link"></i></a>
</h5>
<p>Similar to individual <code>Param</code>s, the <code>ParamSet</code> provides <code>$test()</code>, <code>$check()</code> and <code>$assert()</code> functions that allow for type and range checking of parameters.
Their argument must be a named list with values that are checked against the respective parameters.
It is possible to check only a subset of parameters.</p>
<div class="sourceCode" id="cb568"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">TRUE</span>, B <span class="op">=</span> <span class="fl">0</span>, E <span class="op">=</span> <span class="va">identity</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "A: Must be of type 'logical flag', not 'double'"</code></pre>
<div class="sourceCode" id="cb572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Parameter 'Z' not available. Did you mean 'A' / 'B' / 'C'?"</code></pre>
</div>
<div id="values-in-a-paramset" class="section level5" number="6.4.2.2.2">
<h5>
<span class="header-section-number">6.4.2.2.2</span> Values in a <code>ParamSet</code><a class="anchor" aria-label="anchor" href="#values-in-a-paramset"><i class="fas fa-link"></i></a>
</h5>
<p>Although a <code>ParamSet</code> fundamentally represents a value space, it also has a slot <code>$values</code> that can contain a point within that space.
This is useful because many things that define a parameter space need similar operations (like parameter checking) that can be simplified.
The <code>$values</code> slot contains a named list that is always checked against parameter constraints.
When trying to set parameter values, e.g. for <code>mlr3</code> <code>Learner</code>s, it is the <code>$values</code> slot of its <code>$param_set</code> that needs to be used.</p>
<div class="sourceCode" id="cb574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">TRUE</span>, B <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">ps</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">B</span> <span class="op">=</span> <span class="fl">1</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></code></pre></div>
<pre><code>## $A
## [1] TRUE
## 
## $B
## [1] 1</code></pre>
<p>The parameter constraints are automatically checked:</p>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">B</span> <span class="op">=</span> <span class="fl">100</span></code></pre></div>
<pre><code>## Error in self$assert(xs): Assertion on 'xs' failed: B: Element 1 is not &lt;= 10.</code></pre>
</div>
<div id="dependencies" class="section level5" number="6.4.2.2.3">
<h5>
<span class="header-section-number">6.4.2.2.3</span> Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"><i class="fas fa-link"></i></a>
</h5>
<p>It is often the case that certain parameters are irrelevant or should not be given depending on values of other parameters.
An example would be a parameter that switches a certain algorithm feature (for example regularization) on or off, combined with another parameter that controls the behavior of that feature (e.g. a regularization parameter).
The second parameter would be said to <em>depend</em> on the first parameter having the value <code>TRUE</code>.</p>
<p>A dependency can be added using the <code>$add_dep</code> method, which takes both the ids of the “depender” and “dependee” parameters as well as a <code>Condition</code> object.
The <code>Condition</code> object represents the check to be performed on the “dependee”.
Currently it can be created using <code>CondEqual$new()</code> and <code>CondAnyOf$new()</code>.
Multiple dependencies can be added, and parameters that depend on others can again be depended on, as long as no cyclic dependencies are introduced.</p>
<p>The consequence of dependencies are twofold:
For one, the <code>$check()</code>, <code>$test()</code> and <code>$assert()</code> tests will not accept the presence of a parameter if its dependency is not met.
Furthermore, when sampling or creating grid designs from a <code>ParamSet</code>, the dependencies will be respected (see <a href="technical.html#parameter-sampling">Parameter Sampling</a>, in particular <a href="technical.html#hierarchical-sampler">Hierarchical Sampler</a>).</p>
<p>The following example makes parameter <code>D</code> depend on parameter <code>A</code> being <code>FALSE</code>, and parameter <code>B</code> depend on parameter <code>D</code> being one of <code>"x"</code> or <code>"y"</code>.
This introduces an implicit dependency of <code>B</code> on <code>A</code> being <code>FALSE</code> as well, because <code>D</code> does not take any value if <code>A</code> is <code>TRUE</code>.</p>
<div class="sourceCode" id="cb578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">add_dep</span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"A"</span>, <span class="va"><a href="https://paradox.mlr-org.com/reference/Condition.html">CondEqual</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">ps</span><span class="op">$</span><span class="fu">add_dep</span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"D"</span>, <span class="va"><a href="https://paradox.mlr-org.com/reference/Condition.html">CondAnyOf</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">FALSE</span>, D <span class="op">=</span> <span class="st">"x"</span>, B <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>          <span class="co"># OK: all dependencies met</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">FALSE</span>, D <span class="op">=</span> <span class="st">"z"</span>, B <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>          <span class="co"># B's dependency is not met</span></code></pre></div>
<pre><code>## [1] "The parameter 'B' can only be set if the following condition is met 'D ∈ {x, y}'. Instead the current parameter value is: D=z"</code></pre>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">FALSE</span>, B <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>                   <span class="co"># B's dependency is not met</span></code></pre></div>
<pre><code>## [1] "The parameter 'B' can only be set if the following condition is met 'D ∈ {x, y}'. Instead the parameter value for 'D' is not set at all. Try setting 'D' to a value that satisfies the condition"</code></pre>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">FALSE</span>, D <span class="op">=</span> <span class="st">"z"</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># OK: B is absent</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>                           <span class="co"># OK: neither B nor D present</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">TRUE</span>, D <span class="op">=</span> <span class="st">"x"</span>, B <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>           <span class="co"># D's dependency is not met</span></code></pre></div>
<pre><code>## [1] "The parameter 'D' can only be set if the following condition is met 'A = FALSE'. Instead the current parameter value is: A=TRUE"</code></pre>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="cn">TRUE</span>, B <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>                    <span class="co"># B's dependency is not met</span></code></pre></div>
<pre><code>## [1] "The parameter 'B' can only be set if the following condition is met 'D ∈ {x, y}'. Instead the parameter value for 'D' is not set at all. Try setting 'D' to a value that satisfies the condition"</code></pre>
<p>Internally, the dependencies are represented as a <code>data.table</code>, which can be accessed listed in the <strong><code>$deps</code></strong> slot.
This <code>data.table</code> can even be mutated, to e.g. remove dependencies.
There are no sanity checks done when the <code>$deps</code> slot is changed this way.
Therefore it is advised to be cautious.</p>
<div class="sourceCode" id="cb593"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="va">deps</span></code></pre></div>
<pre><code>##    id on           cond
## 1:  D  A &lt;CondEqual[9]&gt;
## 2:  B  D &lt;CondAnyOf[9]&gt;</code></pre>
</div>
</div>
<div id="vector-parameters" class="section level4" number="6.4.2.3">
<h4>
<span class="header-section-number">6.4.2.3</span> Vector Parameters<a class="anchor" aria-label="anchor" href="#vector-parameters"><i class="fas fa-link"></i></a>
</h4>
<p>Unlike in the old <code>ParamHelpers</code> package, there are no more vectorial parameters in <code>paradox</code>.
Instead, it is now possible to create multiple copies of a single parameter using the <code>$rep</code> function.
This creates a <code>ParamSet</code> consisting of multiple copies of the parameter, which can then (optionally) be added to another <code>ParamSet</code>.</p>
<div class="sourceCode" id="cb595"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps2d</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamDbl.html">ParamDbl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"x"</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="fu">rep</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ps2d</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##         id    class lower upper nlevels        default value
## 1: x_rep_1 ParamDbl     0     1     Inf &lt;NoDefault[3]&gt;      
## 2: x_rep_2 ParamDbl     0     1     Inf &lt;NoDefault[3]&gt;</code></pre>
<div class="sourceCode" id="cb597"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">ps2d</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##         id    class lower upper nlevels        default parents value
## 1:       A ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;          TRUE
## 2:       B ParamInt     0    10      11 &lt;NoDefault[3]&gt;       D     1
## 3:       C ParamDbl     0     4     Inf &lt;NoDefault[3]&gt;              
## 4:       D ParamFct    NA    NA       3              y       A      
## 5:       E ParamUty    NA    NA     Inf &lt;NoDefault[3]&gt;              
## 6: x_rep_1 ParamDbl     0     1     Inf &lt;NoDefault[3]&gt;              
## 7: x_rep_2 ParamDbl     0     1     Inf &lt;NoDefault[3]&gt;</code></pre>
<p>It is also possible to use a <code>ParamUty</code> to accept vectorial parameters, which also works for parameters of variable length.
A <code>ParamSet</code> containing a <code>ParamUty</code> can be used for parameter checking, but not for <a href="technical.html#parameter-sampling">sampling</a>.
To sample values for a method that needs a vectorial parameter, it is advised to use a <a href="technical.html#transformation-between-types">parameter transformation</a> function that creates a vector from atomic values.</p>
<p>Assembling a vector from repeated parameters is aided by the parameter’s <code>$tags</code>: Parameters that were generated by the <code>$rep()</code> command automatically get tagged as belonging to a group of repeated parameters.</p>
<div class="sourceCode" id="cb599"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps</span><span class="op">$</span><span class="va">tags</span></code></pre></div>
<pre><code>## $A
## character(0)
## 
## $B
## [1] "tag1" "tag2"
## 
## $C
## character(0)
## 
## $D
## character(0)
## 
## $E
## character(0)
## 
## $x_rep_1
## [1] "x_rep"
## 
## $x_rep_2
## [1] "x_rep"</code></pre>
</div>
</div>
<div id="parameter-sampling" class="section level3" number="6.4.3">
<h3>
<span class="header-section-number">6.4.3</span> Parameter Sampling<a class="anchor" aria-label="anchor" href="#parameter-sampling"><i class="fas fa-link"></i></a>
</h3>
<p>It is often useful to have a list of possible parameter values that can be systematically iterated through, for example to find parameter values for which an algorithm performs particularly well (tuning).
<code>paradox</code> offers a variety of functions that allow creating evenly-spaced parameter values in a “grid” design as well as random sampling.
In the latter case, it is possible to influence the sampling distribution in more or less fine detail.</p>
<p>A point to always keep in mind while sampling is that only numerical and factorial parameters that are bounded can be sampled from, i.e. not <code>ParamUty</code>.
Furthermore, for most samplers <code>ParamInt</code> and <code>ParamDbl</code> must have finite lower and upper bounds.</p>
<div id="parameter-designs" class="section level4" number="6.4.3.1">
<h4>
<span class="header-section-number">6.4.3.1</span> Parameter Designs<a class="anchor" aria-label="anchor" href="#parameter-designs"><i class="fas fa-link"></i></a>
</h4>
<p>Functions that sample the parameter space fundamentally return an object of the <code>Design</code> class.
These objects contain the sampled data as a <code>data.table</code> under the <code>$data</code> slot, and also offer conversion to a list of parameter-values using the <strong><code>$transpose()</code></strong> function.</p>
</div>
<div id="grid-design" class="section level4" number="6.4.3.2">
<h4>
<span class="header-section-number">6.4.3.2</span> Grid Design<a class="anchor" aria-label="anchor" href="#grid-design"><i class="fas fa-link"></i></a>
</h4>
<p>The <code><a href="https://paradox.mlr-org.com/reference/generate_design_grid.html">generate_design_grid()</a></code> function is used to create grid designs that contain all combinations of parameter values: All possible values for <code>ParamLgl</code> and <code>ParamFct</code>, and values with a given resolution for <code>ParamInt</code> and <code>ParamDbl</code>.
The resolution can be given for all numeric parameters, or for specific named parameters through the <code>param_resolutions</code> parameter.</p>
<div class="sourceCode" id="cb601"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/generate_design_grid.html">generate_design_grid</a></span><span class="op">(</span><span class="va">psSmall</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;Design&gt; with 8 rows:
##        A  B C
## 1:  TRUE  0 0
## 2:  TRUE  0 4
## 3:  TRUE 10 0
## 4:  TRUE 10 4
## 5: FALSE  0 0
## 6: FALSE  0 4
## 7: FALSE 10 0
## 8: FALSE 10 4</code></pre>
<div class="sourceCode" id="cb603"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://paradox.mlr-org.com/reference/generate_design_grid.html">generate_design_grid</a></span><span class="op">(</span><span class="va">psSmall</span>, param_resolutions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>B <span class="op">=</span> <span class="fl">1</span>, C <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;Design&gt; with 4 rows:
##    B C     A
## 1: 0 0  TRUE
## 2: 0 0 FALSE
## 3: 0 4  TRUE
## 4: 0 4 FALSE</code></pre>
</div>
<div id="random-sampling" class="section level4" number="6.4.3.3">
<h4>
<span class="header-section-number">6.4.3.3</span> Random Sampling<a class="anchor" aria-label="anchor" href="#random-sampling"><i class="fas fa-link"></i></a>
</h4>
<p><code>paradox</code> offers different methods for random sampling, which vary in the degree to which they can be configured.
The easiest way to get a uniformly random sample of parameters is <code>generate_design_random</code>.
It is also possible to create “<a href="https://en.wikipedia.org/wiki/Latin_hypercube_sampling">latin hypercube</a>” sampled parameter values using <strong><code>generate_design_lhs</code></strong>, which utilizes the <a href="https://cran.r-project.org/package=lhs">lhs</a> package.
LHS-sampling creates low-discrepancy sampled values that cover the parameter space more evenly than purely random values.</p>
<div class="sourceCode" id="cb605"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pvrand</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/generate_design_random.html">generate_design_random</a></span><span class="op">(</span><span class="va">ps2d</span>, <span class="fl">500</span><span class="op">)</span>
<span class="va">pvlhs</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/generate_design_lhs.html">generate_design_lhs</a></span><span class="op">(</span><span class="va">ps2d</span>, <span class="fl">500</span><span class="op">)</span></code></pre></div>
<p><img src="06-technical-paradox_files/figure-html/05-technical-paradox-023-1.svg" width="45%" style="display: block; margin: auto;"><img src="06-technical-paradox_files/figure-html/05-technical-paradox-023-2.svg" width="45%" style="display: block; margin: auto;"></p>
</div>
<div id="generalized-sampling-the-sampler-class" class="section level4" number="6.4.3.4">
<h4>
<span class="header-section-number">6.4.3.4</span> Generalized Sampling: The <code>Sampler</code> Class<a class="anchor" aria-label="anchor" href="#generalized-sampling-the-sampler-class"><i class="fas fa-link"></i></a>
</h4>
<p>It may sometimes be desirable to configure parameter sampling in more detail.
<code>paradox</code> uses the <code>Sampler</code> abstract base class for sampling, which has many different sub-classes that can be parameterized and combined to control the sampling process.
It is even possible to create further sub-classes of the <code>Sampler</code> class (or of any of <em>its</em> subclasses) for even more possibilities.</p>
<p>Every <code>Sampler</code> object has a <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> function, which takes one argument, the number of instances to sample, and returns a <a href="technical.html#parameter-designs"><code>Design</code></a> object.</p>
<div id="d-samplers" class="section level5" number="6.4.3.4.1">
<h5>
<span class="header-section-number">6.4.3.4.1</span> 1D-Samplers<a class="anchor" aria-label="anchor" href="#d-samplers"><i class="fas fa-link"></i></a>
</h5>
<p>There is a variety of samplers that sample values for a single parameter.
These are <code>Sampler1DUnif</code> (uniform sampling), <code>Sampler1DCateg</code> (sampling for categorical parameters), <code>Sampler1DNormal</code> (normally distributed sampling, truncated at parameter bounds), and <code>Sampler1DRfun</code> (arbitrary 1D sampling, given a random-function).
These are initialized with a single <code>Param</code>, and can then be used to sample values.</p>
<div class="sourceCode" id="cb606"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sampA</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/Sampler1DCateg.html">Sampler1DCateg</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">parA</span><span class="op">)</span>
<span class="va">sampA</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;Design&gt; with 5 rows:
##        A
## 1: FALSE
## 2:  TRUE
## 3:  TRUE
## 4:  TRUE
## 5: FALSE</code></pre>
</div>
<div id="hierarchical-sampler" class="section level5" number="6.4.3.4.2">
<h5>
<span class="header-section-number">6.4.3.4.2</span> Hierarchical Sampler<a class="anchor" aria-label="anchor" href="#hierarchical-sampler"><i class="fas fa-link"></i></a>
</h5>
<p>The <code>SamplerHierarchical</code> sampler is an auxiliary sampler that combines many 1D-Samplers to get a combined distribution.
Its name “hierarchical” implies that it is able to respect parameter dependencies.
This suggests that parameters only get sampled when their dependencies are met.</p>
<p>The following example shows how this works: The <code>Int</code> parameter <code>B</code> depends on the <code>Lgl</code> parameter <code>A</code> being <code>TRUE</code>.
<code>A</code> is sampled to be <code>TRUE</code> in about half the cases, in which case <code>B</code> takes a value between 0 and 10.
In the cases where <code>A</code> is <code>FALSE</code>, <code>B</code> is set to <code>NA</code>.</p>
<div class="sourceCode" id="cb608"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psSmall</span><span class="op">$</span><span class="fu">add_dep</span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"A"</span>, <span class="va"><a href="https://paradox.mlr-org.com/reference/Condition.html">CondEqual</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">sampH</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/SamplerHierarchical.html">SamplerHierarchical</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">psSmall</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com/reference/Sampler1DCateg.html">Sampler1DCateg</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">parA</span><span class="op">)</span>,
    <span class="va"><a href="https://paradox.mlr-org.com/reference/Sampler1DUnif.html">Sampler1DUnif</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">parB</span><span class="op">)</span>,
    <span class="va"><a href="https://paradox.mlr-org.com/reference/Sampler1DUnif.html">Sampler1DUnif</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">parC</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">sampled</span> <span class="op">=</span> <span class="va">sampH</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sampled</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">]</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span></code></pre></div>
<pre><code>##        B
## A         0   1   2   3   4   5   6   7   8   9  10 &lt;NA&gt;
##   FALSE   0   0   0   0   0   0   0   0   0   0   0  518
##   TRUE   44  46  47  42  50  47  37  46  35  38  50    0</code></pre>
</div>
<div id="joint-sampler" class="section level5" number="6.4.3.4.3">
<h5>
<span class="header-section-number">6.4.3.4.3</span> Joint Sampler<a class="anchor" aria-label="anchor" href="#joint-sampler"><i class="fas fa-link"></i></a>
</h5>
<p>Another way of combining samplers is the <code>SamplerJointIndep</code>.
<code>SamplerJointIndep</code> also makes it possible to combine <code>Sampler</code>s that are not 1D.
However, <code>SamplerJointIndep</code> currently can not handle <code>ParamSet</code>s with dependencies.</p>
<div class="sourceCode" id="cb610"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sampJ</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/SamplerJointIndep.html">SamplerJointIndep</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com/reference/Sampler1DUnif.html">Sampler1DUnif</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamDbl.html">ParamDbl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
    <span class="va"><a href="https://paradox.mlr-org.com/reference/Sampler1DUnif.html">Sampler1DUnif</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamDbl.html">ParamDbl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"y"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">sampJ</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;Design&gt; with 5 rows:
##         x      y
## 1: 0.9504 0.5317
## 2: 0.2025 0.4928
## 3: 0.5870 0.1605
## 4: 0.6195 0.8618
## 5: 0.9854 0.1508</code></pre>
</div>
<div id="samplerunif" class="section level5" number="6.4.3.4.4">
<h5>
<span class="header-section-number">6.4.3.4.4</span> SamplerUnif<a class="anchor" aria-label="anchor" href="#samplerunif"><i class="fas fa-link"></i></a>
</h5>
<p>The <code>Sampler</code> used in <code>generate_design_random</code> is the <code>SamplerUnif</code> sampler, which corresponds to a <code>HierarchicalSampler</code> of <code>Sampler1DUnif</code> for all parameters.</p>
</div>
</div>
</div>
<div id="parameter-transformation" class="section level3" number="6.4.4">
<h3>
<span class="header-section-number">6.4.4</span> Parameter Transformation<a class="anchor" aria-label="anchor" href="#parameter-transformation"><i class="fas fa-link"></i></a>
</h3>
<p>While the different <code>Sampler</code>s allow for a wide specification of parameter distributions, there are cases where the simplest way of getting a desired distribution is to sample parameters from a simple distribution (such as the uniform distribution) and then transform them.
This can be done by assigning a function to the <code>$trafo</code> slot of a <code>ParamSet</code>.
The <code>$trafo</code> function is called with two parameters:</p>
<ul>
<li>The list of parameter values to be transformed as <code>x</code>
</li>
<li>The <code>ParamSet</code> itself as <code>param_set</code>
</li>
</ul>
<p>The <code>$trafo</code> function must return a list of transformed parameter values.</p>
<p>The transformation is performed when calling the <code>$transpose</code> function of the <code>Design</code> object returned by a <code>Sampler</code> with the <code>trafo</code> ParamSet to <code>TRUE</code> (the default).
The following, for example, creates a parameter that is exponentially distributed:</p>
<div class="sourceCode" id="cb612"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psexp</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va"><a href="https://paradox.mlr-org.com/reference/ParamDbl.html">ParamDbl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"par"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">psexp</span><span class="op">$</span><span class="va">trafo</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">param_set</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">$</span><span class="va">par</span> <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">par</span><span class="op">)</span>
  <span class="va">x</span>
<span class="op">}</span>
<span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/generate_design_random.html">generate_design_random</a></span><span class="op">(</span><span class="va">psexp</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;Design&gt; with 2 rows:
##       par
## 1: 0.4870
## 2: 0.4668</code></pre>
<div class="sourceCode" id="cb614"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span><span class="op">$</span><span class="fu">transpose</span><span class="op">(</span><span class="op">)</span>  <span class="co"># trafo is TRUE</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$par
## [1] 0.7195
## 
## 
## [[2]]
## [[2]]$par
## [1] 0.7619</code></pre>
<p>Compare this to <code>$transpose()</code> without transformation:</p>
<div class="sourceCode" id="cb616"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span><span class="op">$</span><span class="fu">transpose</span><span class="op">(</span>trafo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$par
## [1] 0.487
## 
## 
## [[2]]
## [[2]]$par
## [1] 0.4668</code></pre>
<div id="transformation-between-types" class="section level4" number="6.4.4.1">
<h4>
<span class="header-section-number">6.4.4.1</span> Transformation between Types<a class="anchor" aria-label="anchor" href="#transformation-between-types"><i class="fas fa-link"></i></a>
</h4>
<p>Usually the design created with one <code>ParamSet</code> is then used to configure other objects that themselves have a <code>ParamSet</code> which defines the values they take.
The <code>ParamSet</code>s which can be used for random sampling, however, are restricted in some ways:
They must have finite bounds, and they may not contain “untyped” (<code>ParamUty</code>) parameters.
<code>$trafo</code> provides the glue for these situations.
There is relatively little constraint on the trafo function’s return value, so it is possible to return values that have different bounds or even types than the original <code>ParamSet</code>.
It is even possible to remove some parameters and add new ones.</p>
<p>Suppose, for example, that a certain method requires a <em>function</em> as a parameter.
Let’s say a function that summarizes its data in a certain way.
The user can pass functions like <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code> or <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, but could also pass quantiles or something completely different.
This method would probably use the following <code>ParamSet</code>:</p>
<div class="sourceCode" id="cb618"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">methodPS</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamUty.html">ParamUty</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"fun"</span>,
      custom_check <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">checkmate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/checkmate/man/checkFunction.html">checkFunction</a></span><span class="op">(</span><span class="va">x</span>, nargs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">methodPS</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ParamSet&gt;
##     id    class lower upper nlevels        default value
## 1: fun ParamUty    NA    NA     Inf &lt;NoDefault[3]&gt;</code></pre>
<p>If one wanted to sample this method, using one of four functions, a way to do this would be:</p>
<div class="sourceCode" id="cb620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">samplingPS</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamFct.html">ParamFct</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"fun"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">samplingPS</span><span class="op">$</span><span class="va">trafo</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">param_set</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># x$fun is a `character(1)`,</span>
  <span class="co"># in particular one of 'mean', 'median', 'min', 'max'.</span>
  <span class="co"># We want to turn it into a function!</span>
  <span class="va">x</span><span class="op">$</span><span class="va">fun</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">fun</span>, mode <span class="op">=</span> <span class="st">"function"</span><span class="op">)</span>
  <span class="va">x</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb621"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/generate_design_random.html">generate_design_random</a></span><span class="op">(</span><span class="va">samplingPS</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;Design&gt; with 2 rows:
##       fun
## 1:    max
## 2: median</code></pre>
<p>Note that the <code>Design</code> only contains the column “<code>fun</code>” as a <code>character</code> column.
To get a single value as a <em>function</em>, the <code>$transpose</code> function is used.</p>
<div class="sourceCode" id="cb623"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xvals</span> <span class="op">=</span> <span class="va">design</span><span class="op">$</span><span class="fu">transpose</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## $fun
## function (..., na.rm = FALSE)  .Primitive("max")</code></pre>
<p>We can now check that it fits the requirements set by <code>methodPS</code>, and that <code>fun</code> it is in fact a function:</p>
<div class="sourceCode" id="cb625"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">methodPS</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="va">xvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">fun</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>Imagine now that a different kind of parametrization of the function is desired:
The user wants to give a function that selects a certain quantile, where the quantile is set by a parameter.
In that case the <code>$transpose</code> function could generate a function in a different way.
For interpretability, the parameter is called “<code>quantile</code>” before transformation, and the “<code>fun</code>” parameter is generated on the fly.</p>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">samplingPS2</span> <span class="op">=</span> <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamSet.html">ParamSet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va"><a href="https://paradox.mlr-org.com/reference/ParamDbl.html">ParamDbl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"quantile"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">samplingPS2</span><span class="op">$</span><span class="va">trafo</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">param_set</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># x$quantile is a `numeric(1)` between 0 and 1.</span>
  <span class="co"># We want to turn it into a function!</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">input</span>, <span class="va">x</span><span class="op">$</span><span class="va">quantile</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb630"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/generate_design_random.html">generate_design_random</a></span><span class="op">(</span><span class="va">samplingPS2</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;Design&gt; with 2 rows:
##    quantile
## 1:   0.6281
## 2:   0.9859</code></pre>
<p>The <code>Design</code> now contains the column “<code>quantile</code>” that will be used by the <code>$transpose</code> function to create the <code>fun</code> parameter.
We also check that it fits the requirement set by <code>methodPS</code>, and that it is a function.</p>
<div class="sourceCode" id="cb632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xvals</span> <span class="op">=</span> <span class="va">design</span><span class="op">$</span><span class="fu">transpose</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">xvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## $fun
## function(input) quantile(input, x$quantile)
## &lt;environment: 0x55b2e8feaf20&gt;</code></pre>
<div class="sourceCode" id="cb634"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">methodPS</span><span class="op">$</span><span class="fu">check</span><span class="op">(</span><span class="va">xvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xvals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">fun</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>## 62.80728% 
##     6.653</code></pre>

</div>
</div>
</div>
<div id="logging" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Logging<a class="anchor" aria-label="anchor" href="#logging"><i class="fas fa-link"></i></a>
</h2>
<p>We use the <a href="https://cran.r-project.org/package=lgr">lgr</a> package for logging and progress output.</p>
<div id="changing-mlr3-logging-levels" class="section level3" number="6.5.1">
<h3>
<span class="header-section-number">6.5.1</span> Changing mlr3 logging levels<a class="anchor" aria-label="anchor" href="#changing-mlr3-logging-levels"><i class="fas fa-link"></i></a>
</h3>
<p>To change the setting for <a href="https://mlr3.mlr-org.com">mlr3</a> for the current session, you need to retrieve the logger (which is a <a href="https://cran.r-project.org/package=R6">R6</a> object) from <a href="https://cran.r-project.org/package=lgr">lgr</a>, and then change the threshold of the like this:</p>
<div class="sourceCode" id="cb638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"lgr"</span><span class="op">)</span>

<span class="va">logger</span> <span class="op">=</span> <span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/get_logger.html">get_logger</a></span><span class="op">(</span><span class="st">"mlr3"</span><span class="op">)</span>
<span class="va">logger</span><span class="op">$</span><span class="fu">set_threshold</span><span class="op">(</span><span class="st">"&lt;level&gt;"</span><span class="op">)</span></code></pre></div>
<p>The default log level is <code>"info"</code>.
All available levels can be listed as follows:</p>
<div class="sourceCode" id="cb639"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"lgr.log_levels"</span><span class="op">)</span></code></pre></div>
<pre><code>## fatal error  warn  info debug trace 
##   100   200   300   400   500   600</code></pre>
<p>To increase verbosity, set the log level to a higher value, e.g. to <code>"debug"</code> with:</p>
<div class="sourceCode" id="cb641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/get_logger.html">get_logger</a></span><span class="op">(</span><span class="st">"mlr3"</span><span class="op">)</span><span class="op">$</span><span class="fu">set_threshold</span><span class="op">(</span><span class="st">"debug"</span><span class="op">)</span></code></pre></div>
<p>To reduce the verbosity, reduce the log level to warn:</p>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/get_logger.html">get_logger</a></span><span class="op">(</span><span class="st">"mlr3"</span><span class="op">)</span><span class="op">$</span><span class="fu">set_threshold</span><span class="op">(</span><span class="st">"warn"</span><span class="op">)</span></code></pre></div>
<p><a href="https://cran.r-project.org/package=lgr">lgr</a> comes with a global option called <code>"lgr.default_threshold"</code> which can be set via <code><a href="https://rdrr.io/r/base/options.html">options()</a></code> to make your choice permanent across sessions.</p>
<p>Also note that the optimization packages such as <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a> <a href="https://mlr3fselect.mlr-org.com">mlr3fselect</a> use the logger of their base package <a href="https://bbotk.mlr-org.com">bbotk</a>.
To disable the output from <a href="https://mlr3.mlr-org.com">mlr3</a>, but keep the output from <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a>, reduce the verbosity for the logger <a href="https://mlr3.mlr-org.com">mlr3</a>
and optionally change the logger <a href="https://bbotk.mlr-org.com">bbotk</a> to the desired level.</p>
<div class="sourceCode" id="cb643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/get_logger.html">get_logger</a></span><span class="op">(</span><span class="st">"mlr3"</span><span class="op">)</span><span class="op">$</span><span class="fu">set_threshold</span><span class="op">(</span><span class="st">"warn"</span><span class="op">)</span>
<span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/get_logger.html">get_logger</a></span><span class="op">(</span><span class="st">"bbotk"</span><span class="op">)</span><span class="op">$</span><span class="fu">set_threshold</span><span class="op">(</span><span class="st">"info"</span><span class="op">)</span></code></pre></div>
</div>
<div id="redirecting-output" class="section level3" number="6.5.2">
<h3>
<span class="header-section-number">6.5.2</span> Redirecting output<a class="anchor" aria-label="anchor" href="#redirecting-output"><i class="fas fa-link"></i></a>
</h3>
<p>Redirecting output is already extensively covered in the documentation and vignette of <a href="https://cran.r-project.org/package=lgr">lgr</a>.
Here is just a short example which adds an additional appender to log events into a temporary file in <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> format:</p>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="st">"mlr3log_"</span>, fileext <span class="op">=</span> <span class="st">".json"</span><span class="op">)</span>

<span class="co"># get the logger as R6 object</span>
<span class="va">logger</span> <span class="op">=</span> <span class="fu">lgr</span><span class="fu">::</span><span class="fu"><a href="https://s-fleck.github.io/lgr/reference/get_logger.html">get_logger</a></span><span class="op">(</span><span class="st">"mlr"</span><span class="op">)</span>

<span class="co"># add Json appender</span>
<span class="va">logger</span><span class="op">$</span><span class="fu">add_appender</span><span class="op">(</span><span class="fu">lgr</span><span class="fu">::</span><span class="va"><a href="https://s-fleck.github.io/lgr/reference/AppenderFile.html">AppenderJson</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">tf</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span>

<span class="co"># signal a warning</span>
<span class="va">logger</span><span class="op">$</span><span class="fu">warn</span><span class="op">(</span><span class="st">"this is a warning from mlr3"</span><span class="op">)</span></code></pre></div>
<pre><code>## WARN  [16:43:37.459] this is a warning from mlr3</code></pre>
<div class="sourceCode" id="cb646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print the contents of the file</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## {"level":300,"timestamp":"2021-11-19 16:43:37","logger":"mlr","caller":"eval","msg":"this is a warning from mlr3"}</code></pre>
<div class="sourceCode" id="cb648"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove the appender again</span>
<span class="va">logger</span><span class="op">$</span><span class="fu">remove_appender</span><span class="op">(</span><span class="st">"json"</span><span class="op">)</span></code></pre></div>
</div>
<div id="immediate-log-feedback" class="section level3" number="6.5.3">
<h3>
<span class="header-section-number">6.5.3</span> Immediate Log Feedback<a class="anchor" aria-label="anchor" href="#immediate-log-feedback"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://mlr3.mlr-org.com">mlr3</a> uses the <a href="technical.html#parallelization">future</a> package and <a href="technical.html#encapsulation">encapsulation</a> to make evaluations fast, stable, and reproducible.
However, this may lead to logs being delayed, out of order, or, in case of some errors, not present at all.
When it is necessary to have immediate access to log messages, for example to investigate problems, one may therefore choose to disable <a href="https://cran.r-project.org/package=future">future</a> and encapsulation.
This can be done by enabling the debug mode using <code>options(mlr.debug = TRUE)</code>; the <code>$encapsulate</code> slot of learners should also be set to <code>"none"</code> (default) or <code>"evaluate"</code>, but not <code>"callr"</code>.
This should only be done to investigate problems, however, and not for production use, because (1) this disables parallelization, and (2) this leads to different RNG behavior and therefore to results that are not reproducible when the debug mode is not set.</p>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="pipelines.html"><span class="header-section-number">5</span> Pipelines</a></div>
<div class="next"><a href="extending.html"><span class="header-section-number">7</span> Extending</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#technical"><span class="header-section-number">6</span> Technical</a></li>
<li>
<a class="nav-link" href="#parallelization"><span class="header-section-number">6.1</span> Parallelization</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#implicit-parallelization"><span class="header-section-number">6.1.1</span> Implicit Parallelization</a></li>
<li><a class="nav-link" href="#explicit-parallelization"><span class="header-section-number">6.1.2</span> Explicit Parallelization</a></li>
<li><a class="nav-link" href="#nested-resampling-parallelization"><span class="header-section-number">6.1.3</span> Nested Resampling Parallelization</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#error-handling"><span class="header-section-number">6.2</span> Error Handling</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#encapsulation"><span class="header-section-number">6.2.1</span> Encapsulation</a></li>
<li><a class="nav-link" href="#fallback-learners"><span class="header-section-number">6.2.2</span> Fallback learners</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#backends"><span class="header-section-number">6.3</span> Database Backends</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#use-case-nyc-flights"><span class="header-section-number">6.3.1</span> Use Case: NYC Flights</a></li>
<li><a class="nav-link" href="#preprocessing-with-dplyr"><span class="header-section-number">6.3.2</span> Preprocessing with dplyr</a></li>
<li><a class="nav-link" href="#databackenddplyr"><span class="header-section-number">6.3.3</span> DataBackendDplyr</a></li>
<li><a class="nav-link" href="#model-fitting"><span class="header-section-number">6.3.4</span> Model fitting</a></li>
<li><a class="nav-link" href="#cleanup"><span class="header-section-number">6.3.5</span> Cleanup</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#paradox"><span class="header-section-number">6.4</span> Parameters (using paradox)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#reference-based-objects"><span class="header-section-number">6.4.1</span> Reference Based Objects</a></li>
<li><a class="nav-link" href="#defining-a-parameter-space"><span class="header-section-number">6.4.2</span> Defining a Parameter Space</a></li>
<li><a class="nav-link" href="#parameter-sampling"><span class="header-section-number">6.4.3</span> Parameter Sampling</a></li>
<li><a class="nav-link" href="#parameter-transformation"><span class="header-section-number">6.4.4</span> Parameter Transformation</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#logging"><span class="header-section-number">6.5</span> Logging</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#changing-mlr3-logging-levels"><span class="header-section-number">6.5.1</span> Changing mlr3 logging levels</a></li>
<li><a class="nav-link" href="#redirecting-output"><span class="header-section-number">6.5.2</span> Redirecting output</a></li>
<li><a class="nav-link" href="#immediate-log-feedback"><span class="header-section-number">6.5.3</span> Immediate Log Feedback</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mlr-org/mlr3book/blob/main/bookdown/06-technical.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mlr-org/mlr3book/edit/main/bookdown/06-technical.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>mlr3 book</strong>" was written by Marc Becker, Martin Binder, Bernd Bischl, Lars Kotthoff, Michel Lang, Florian Pfisterer, Nicholas G. Reich, Jakob Richter, Patrick Schratz, Raphael Sonabend, Damir Pulatov. It was last built on 2021-11-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
